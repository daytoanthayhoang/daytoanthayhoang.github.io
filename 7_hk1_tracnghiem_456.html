<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>√în t·∫≠p Chinh Ph·ª•c To√°n 7 HK1 - C√¢u 4, 5, 6</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <!-- MathJax Configuration -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
            },
            startup: {
                typeset: false
            }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap');
        
        body {
            font-family: 'Nunito', sans-serif;
            background-color: #eef2ff; /* Indigo-50 */
        }

        .btn-option {
            transition: all 0.2s ease;
            touch-action: manipulation;
        }
        
        .btn-option:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        .btn-option:active:not(:disabled) {
            transform: scale(0.98);
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        .shake {
            animation: shake 0.3s ease-in-out;
        }

        @keyframes pop {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        .pop {
            animation: pop 0.2s ease-out;
        }

        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .mode-active {
            background-color: #4f46e5; /* indigo-600 */
            color: white;
            border-color: #4f46e5;
        }

        .mode-inactive {
            background-color: white;
            color: #374151;
            border-color: #d1d5db;
        }
        .mode-inactive:hover {
            background-color: #e0e7ff; /* indigo-100 */
        }

        /* Loading Overlay */
        #question-loader {
            position: absolute;
            inset: 0;
            background-color: white;
            z-index: 50;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: opacity 0.2s ease-out;
        }
        .loader-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4f46e5;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .hidden-loader {
            opacity: 0;
            pointer-events: none;
        }

        #main-content-wrapper {
            opacity: 0;
        }
        #main-content-wrapper.content-visible {
            opacity: 1;
            transition: opacity 0.3s ease-in;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center p-4">

    <!-- Header -->
    <header class="w-full max-w-3xl text-center mb-6">
        <h1 class="text-2xl md:text-3xl font-extrabold text-indigo-800 mb-2 uppercase drop-shadow-sm">
            <i class="fas fa-chart-line mr-2"></i>√în t·∫≠p Chinh Ph·ª•c To√°n 7 HK1 - C√¢u 4, 5, 6
        </h1>
        <p class="text-indigo-600 font-medium">Ch·ªß ƒë·ªÅ: Tr·ª•c s·ªë, Th·ª© t·ª± & Gi√° tr·ªã tuy·ªát ƒë·ªëi</p>
    </header>

    <!-- Mode Selection -->
    <div class="w-full max-w-3xl grid grid-cols-2 md:grid-cols-4 gap-2 mb-6">
        <button onclick="setMode('all')" id="btn-mode-all" class="mode-active py-2 px-2 rounded-lg font-bold border-2 shadow-sm text-sm md:text-base flex flex-col items-center justify-center transition-transform">
            <i class="fas fa-random mb-1"></i> T·ªïng H·ª£p
        </button>
        <button onclick="setMode('q4')" id="btn-mode-q4" class="mode-inactive py-2 px-2 rounded-lg font-bold border-2 shadow-sm text-sm md:text-base flex flex-col items-center justify-center transition-transform">
            <i class="fas fa-arrows-alt-h mb-1"></i> C√¢u 4: Tr·ª•c s·ªë
        </button>
        <button onclick="setMode('q5')" id="btn-mode-q5" class="mode-inactive py-2 px-2 rounded-lg font-bold border-2 shadow-sm text-sm md:text-base flex flex-col items-center justify-center transition-transform">
            <i class="fas fa-sort-numeric-down mb-1"></i> C√¢u 5: Th·ª© t·ª±
        </button>
        <button onclick="setMode('q6')" id="btn-mode-q6" class="mode-inactive py-2 px-2 rounded-lg font-bold border-2 shadow-sm text-sm md:text-base flex flex-col items-center justify-center transition-transform">
            <i class="fas fa-equals mb-1"></i> C√¢u 6: GTTƒê
        </button>
    </div>

    <!-- Stats Board -->
    <div class="w-full max-w-3xl bg-white rounded-xl shadow-md p-4 mb-6 grid grid-cols-4 gap-2 text-center select-none" id="stats-container">
        <!-- Rendered by JS -->
    </div>

    <!-- Question Card -->
    <div class="w-full max-w-3xl bg-white rounded-2xl shadow-lg border-b-4 border-indigo-600 p-6 relative overflow-hidden" style="min-height: 400px;">
        
        <!-- Loading Overlay -->
        <div id="question-loader">
            <div class="loader-spinner mb-3"></div>
            <span class="text-indigo-600 font-bold text-sm">ƒêang t·∫£i c√¢u h·ªèi...</span>
        </div>

        <!-- Question Badge -->
        <div class="absolute top-0 left-0 bg-indigo-100 text-indigo-800 px-3 py-1 rounded-br-lg text-xs font-bold uppercase z-10" id="question-type-badge">
            D·∫°ng c√¢u h·ªèi
        </div>

        <!-- CONTENT WRAPPER -->
        <div id="main-content-wrapper" class="flex flex-col h-full justify-between pt-6">
            
            <!-- Question Content -->
            <div class="mb-6 fade-in">
                <h2 class="text-xl md:text-2xl font-bold text-gray-800 text-left leading-relaxed" id="question-text">
                    <!-- Question goes here -->
                </h2>
            </div>

            <!-- Options Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6" id="options-container">
                <!-- Buttons will be injected here -->
            </div>

            <!-- Explanation Area -->
            <div id="explanation-area" class="hidden mb-6 p-4 bg-yellow-50 border-l-4 border-yellow-400 rounded-r-lg text-gray-700 text-sm md:text-base fade-in">
                 <!-- JS will inject content -->
            </div>

            <!-- Feedback & Next -->
            <div class="mt-auto h-12 flex items-center justify-between">
                <div id="feedback-msg" class="text-lg font-bold hidden pl-2"></div>
                <button onclick="handleNextClick()" id="btn-next" class="bg-white border border-gray-300 text-gray-600 px-6 py-2 rounded-full font-bold hover:bg-gray-100 transition flex items-center ml-auto shadow-sm">
                    B·ªè qua <i class="fas fa-forward ml-2"></i>
                </button>
            </div>
        </div>
    </div>

    <footer class="mt-auto py-6 text-center text-gray-400 text-xs">
        ¬© Th·∫ßy Nguy·ªÖn Vi·ªát Ho√†ng - Tr∆∞·ªùng THCS Nguy·ªÖn An Kh∆∞∆°ng - daytoanthayhoang.github.io
    </footer>

    <!-- Feedback Modal (Overlay) -->
    <div id="feedback-overlay" class="fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center p-4 fade-in">
        <div class="bg-white rounded-2xl shadow-2xl max-w-lg w-full p-6 text-center relative">
            <div id="feedback-icon" class="text-6xl mb-4"></div>
            <h3 id="feedback-title" class="text-2xl font-bold mb-2"></h3>
            <p id="feedback-message" class="text-gray-700 mb-4 text-lg font-medium"></p>
            <div class="bg-indigo-50 p-4 rounded-xl text-left mb-6">
                <p class="text-xs text-indigo-500 font-bold uppercase mb-1">Gi·∫£i th√≠ch chi ti·∫øt:</p>
                <div id="feedback-detail" class="text-gray-800 text-sm leading-relaxed"></div>
            </div>
            <button onclick="closeModal()" class="w-full py-3 bg-indigo-600 text-white font-bold rounded-xl shadow-lg hover:bg-indigo-700 transition transform hover:-translate-y-1">
                ƒê√≥ng ƒë·ªÉ xem l·∫°i <i class="fas fa-times ml-2"></i>
            </button>
        </div>
    </div>

    <script>
        // --- DATA & STATE ---
        const state = {
            mode: 'all', // all, q4, q5, q6
            streak: 0,
            correct: 0,
            wrong: 0,
            skipped: 0,
            currentQuestion: null,
            isAnswered: false
        };

        // --- UTILS ---
        const randomInt = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
        
        const shuffleArray = (array) => {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        };

        const formatDecimal = (num) => num.toString().replace('.', ',');

        // --- GENERATORS ---

        // ================= C√ÇU 4: TR·ª§C S·ªê TH·ª∞C =================
        const generateQuestion4 = () => {
            const type = randomInt(1, 4);
            let question, correct, options, explanation, typeLabel;

            if (type === 1) {
                typeLabel = "C√¢u 4: V·ªã tr√≠ tr√™n tr·ª•c s·ªë";
                const vars = [['a', 'b', 'A', 'B'], ['x', 'y', 'M', 'N'], ['c', 'd', 'C', 'D'], ['m', 'n', 'M', 'N']];
                const v = vars[randomInt(0, vars.length-1)];
                
                if (Math.random() < 0.5) {
                    question = `Tr√™n tr·ª•c s·ªë n·∫±m ngang, ƒëi·ªÉm $${v[2]}$ v√† $${v[3]}$ l·∫ßn l∆∞·ª£t bi·ªÉu di·ªÖn hai s·ªë th·ª±c $${v[0]}$ v√† $${v[1]}$. Bi·∫øt r·∫±ng $${v[0]} < ${v[1]}$ th√¨:`;
                    correct = `ƒêi·ªÉm $${v[2]}$ n·∫±m b√™n tr√°i ƒëi·ªÉm $${v[3]}$`;
                    options = shuffleArray([
                        correct,
                        `ƒêi·ªÉm $${v[2]}$ n·∫±m b√™n ph·∫£i ƒëi·ªÉm $${v[3]}$`,
                        `ƒêi·ªÉm $${v[2]}$ tr√πng v·ªõi ƒëi·ªÉm $${v[3]}$`,
                        `ƒêi·ªÉm $${v[2]}$ n·∫±m g·∫ßn s·ªë 0 h∆°n ƒëi·ªÉm $${v[3]}$`
                    ]);
                    explanation = `V√¨ $${v[0]} < ${v[1]}$ n√™n ƒëi·ªÉm bi·ªÉu di·ªÖn s·ªë nh·ªè h∆°n ($${v[2]}$) n·∫±m b√™n <b>tr√°i</b> ƒëi·ªÉm bi·ªÉu di·ªÖn s·ªë l·ªõn h∆°n ($${v[3]}$).`;
                } else {
                    question = `Tr√™n tr·ª•c s·ªë n·∫±m ngang, ƒëi·ªÉm $${v[2]}$ v√† $${v[3]}$ l·∫ßn l∆∞·ª£t bi·ªÉu di·ªÖn hai s·ªë th·ª±c $${v[0]}$ v√† $${v[1]}$. Bi·∫øt r·∫±ng $${v[2]}$ n·∫±m b√™n ph·∫£i ƒëi·ªÉm $${v[3]}$ th√¨:`;
                    correct = `$${v[0]} > ${v[1]}$`;
                    options = shuffleArray([
                        correct,
                        `$${v[0]} < ${v[1]}$`,
                        `$${v[0]} = ${v[1]}$`,
                        `$${v[0]} \\le ${v[1]}$`
                    ]);
                    explanation = `ƒêi·ªÉm n·∫±m b√™n <b>ph·∫£i</b> lu√¥n bi·ªÉu di·ªÖn s·ªë l·ªõn h∆°n. Do ƒë√≥ $${v[2]}$ (bi·ªÉu di·ªÖn $${v[0]}$) n·∫±m ph·∫£i $${v[3]}$ (bi·ªÉu di·ªÖn $${v[1]}$) suy ra $${v[0]} > ${v[1]}$.`;
                }
            } else if (type === 2) {
                typeLabel = "C√¢u 4: V·ªã tr√≠ s·ªë c·ª• th·ªÉ";
                const pairs = [
                    {a: "-\\sqrt{5}", b: "-2", valA: -2.236, valB: -2},
                    {a: "-\\sqrt{3}", b: "-1,7", valA: -1.732, valB: -1.7},
                    {a: "\\sqrt{2}", b: "1,5", valA: 1.414, valB: 1.5},
                    {a: "-3", b: "-\\sqrt{10}", valA: -3, valB: -3.16},
                    {a: "-\\sqrt{5}", b: "-2,2", valA: -2.236, valB: -2.2} // D·∫°ng m·ªõi b·ªï sung
                ];
                const p = pairs[randomInt(0, pairs.length-1)];
                const isALess = p.valA < p.valB;
                
                question = `X√©t v·ªã tr√≠ hai s·ªë th·ª±c $a=${p.a}$ v√† $b=${p.b}$ tr√™n tr·ª•c s·ªë n·∫±m ngang, khi ƒë√≥:`;
                correct = isALess ? `$a$ n·∫±m b√™n tr√°i $b$` : `$a$ n·∫±m b√™n ph·∫£i $b$`;
                
                options = shuffleArray([
                    `$a$ n·∫±m b√™n tr√°i $b$`,
                    `$a$ n·∫±m b√™n ph·∫£i $b$`,
                    `$a$ tr√πng v·ªõi $b$`,
                    `Kh√¥ng x√°c ƒë·ªãnh ƒë∆∞·ª£c`
                ]);
                
                explanation = `Ta c√≥ gi√° tr·ªã x·∫•p x·ªâ: $a = ${p.a} \\approx ${formatDecimal(p.valA)}$ v√† $b = ${p.b} \\approx ${formatDecimal(p.valB)}$. <br>V√¨ ${formatDecimal(p.valA)} ${isALess ? '<' : '>'} ${formatDecimal(p.valB)} n√™n $a$ n·∫±m b√™n <b>${isALess ? 'tr√°i' : 'ph·∫£i'}</b> $b$.`;
            } else if (type === 3) {
                typeLabel = "C√¢u 4: Bi·ªÉu di·ªÖn s·ªë th·ª±c";
                const pairs = [
                    {a: "3", b: "1/2", valA: 3, valB: 0.5},
                    {a: "\\sqrt{2}", b: "3/2", valA: 1.41, valB: 1.5},
                    {a: "-1,5", b: "-1", valA: -1.5, valB: -1}
                ];
                const p = pairs[randomInt(0, pairs.length-1)];
                const isALess = p.valA < p.valB;
                
                question = `G·ªçi $A$ l√† ƒëi·ªÉm bi·ªÉu di·ªÖn s·ªë $${p.a}$ v√† $B$ l√† ƒëi·ªÉm bi·ªÉu di·ªÖn s·ªë $${p.b}$ tr√™n tr·ª•c s·ªë. V·ªã tr√≠ t∆∞∆°ng ƒë·ªëi c·ªßa hai ƒëi·ªÉm n√†y l√†:`;
                correct = isALess ? `ƒêi·ªÉm $A$ n·∫±m b√™n tr√°i ƒëi·ªÉm $B$` : `ƒêi·ªÉm $A$ n·∫±m b√™n ph·∫£i ƒëi·ªÉm $B$`;
                
                options = shuffleArray([
                    `ƒêi·ªÉm $A$ n·∫±m b√™n tr√°i ƒëi·ªÉm $B$`,
                    `ƒêi·ªÉm $A$ n·∫±m b√™n ph·∫£i ƒëi·ªÉm $B$`,
                    `ƒêi·ªÉm $A$ v√† $B$ tr√πng nhau`,
                    `Kh√¥ng x√°c ƒë·ªãnh ƒë∆∞·ª£c`
                ]);
                
                explanation = `Ta so s√°nh gi√° tr·ªã: $${p.a} \\approx ${formatDecimal(p.valA)}$ v√† $${p.b} \\approx ${formatDecimal(p.valB)}$.`;
            } else {
                typeLabel = "C√¢u 4: Kho·∫£ng c√°ch ƒë·∫øn g·ªëc O";
                const nums = [
                    {tex: "-5", val: 5}, {tex: "4,5", val: 4.5}, 
                    {tex: "\\sqrt{16}", val: 4}, {tex: "-\\sqrt{9}", val: 3},
                    {tex: "-100", val: 100}, {tex: "99", val: 99}
                ];
                const subset = shuffleArray(nums).slice(0, 4);
                const maxVal = Math.max(...subset.map(x => x.val));
                const correctItem = subset.find(x => x.val === maxVal);
                
                question = `Tr√™n tr·ª•c s·ªë, ƒëi·ªÉm bi·ªÉu di·ªÖn s·ªë n√†o sau ƒë√¢y n·∫±m <b>xa</b> ƒëi·ªÉm g·ªëc $O$ nh·∫•t: $${subset.map(x=>x.tex).join('; ')}$?`;
                correct = `ƒêi·ªÉm bi·ªÉu di·ªÖn $${correctItem.tex}$`;
                options = shuffleArray(subset.map(x => `ƒêi·ªÉm bi·ªÉu di·ªÖn $${x.tex}$`));
                explanation = `Kho·∫£ng c√°ch ƒë·∫øn g·ªëc $O$ ch√≠nh l√† gi√° tr·ªã tuy·ªát ƒë·ªëi. S·ªë c√≥ gi√° tr·ªã tuy·ªát ƒë·ªëi l·ªõn nh·∫•t l√† $${correctItem.tex}$ ($|${correctItem.tex}|=${correctItem.val}$) n√™n ƒëi·ªÉm bi·ªÉu di·ªÖn c·ªßa n√≥ n·∫±m xa $O$ nh·∫•t.`;
            }
            return { typeLabel, text: question, correct, options, explanation };
        };

        // ================= C√ÇU 5: TH·ª® T·ª∞ S·ªê TH·ª∞C =================
        const generateQuestion5 = () => {
            const type = randomInt(1, 4); // TƒÉng l√™n 4 d·∫°ng ƒë·ªÉ bao ph·ªß h·∫øt
            let question, correct, options, explanation, typeLabel;

            if (type === 1) {
                // D·∫°ng 1: T√¨m ch·ªØ s·ªë a
                typeLabel = "C√¢u 5: T√¨m ·∫©n s·ªë";
                const head = randomInt(1, 15);
                const decimals = [randomInt(0,9), randomInt(0,9)];
                const pivot = randomInt(3, 6);
                const ans = pivot + randomInt(1, 3); 
                const wrong1 = pivot - randomInt(1, 2);
                const wrong2 = pivot;
                
                question = `T√¨m ch·ªØ s·ªë $a$ th√≠ch h·ª£p ƒë·ªÉ: $-${head},${decimals.join('')}a2 < -${head},${decimals.join('')}${pivot}1$`;
                correct = `${ans}`;
                options = shuffleArray([`${ans}`, `${wrong1}`, `${wrong2}`, `${pivot-3 < 0 ? 9 : pivot-3}`]);
                
                explanation = `V√¨ l√† hai s·ªë √¢m, ƒë·ªÉ s·ªë b√™n tr√°i nh·ªè h∆°n th√¨ ph·∫ßn gi√° tr·ªã tuy·ªát ƒë·ªëi c·ªßa n√≥ ph·∫£i l·ªõn h∆°n. T·∫°i v·ªã tr√≠ h√†ng ph·∫ßn ngh√¨n: c·∫ßn $a > ${pivot}$. Trong c√°c ƒë√°p √°n, $a=${ans}$ th·ªèa m√£n.`;
            
            } else if (type === 2) {
                // D·∫°ng 2: T√¨m c√¢u ƒê√öNG (C√°c c√¢u g√†i ƒë·∫∑c bi·ªát)
                typeLabel = "C√¢u 5: Ki·ªÉm tra kh·∫≥ng ƒë·ªãnh";
                question = "Trong c√°c kh·∫≥ng ƒë·ªãnh sau, kh·∫≥ng ƒë·ªãnh n√†o l√† <b>ƒê√öNG</b>?";
                
                // T·∫≠p h·ª£p c√°c c√¢u ƒê√öNG g√†i b·∫´y
                const correctStmts = [
                    {
                        tex: "-\\pi > -3,15", 
                        expl: "Ta c√≥ $\\pi \\approx 3,1415... < 3,15$. <br>V√¨ $3,14... < 3,15$ n√™n s·ªë √¢m s·∫Ω ng∆∞·ª£c l·∫°i: $-\\pi > -3,15$."
                    },
                    {
                        tex: "-0,(15) > -0,(16)", 
                        expl: "Khai tri·ªÉn: $-0,(15) = -0,1515...$ v√† $-0,(16) = -0,1616...$ <br>V√¨ $0,15 < 0,16$ n√™n $-0,15... > -0,16...$."
                    },
                    {
                        tex: "-\\sqrt{5} < -2,2", 
                        expl: "Ta c√≥ $\\sqrt{5} \\approx 2,236... > 2,2$. <br>N√™n $-\\sqrt{5} < -2,2$."
                    }
                ];
                const selectedCorrect = correctStmts[randomInt(0, correctStmts.length-1)];
                correct = `$${selectedCorrect.tex}$`;
                
                // T·∫≠p h·ª£p c√°c c√¢u SAI g√†i b·∫´y l√†m nhi·ªÖu
                const falseStmts = [
                    "$\\sqrt{0,4} = 0,2$", // Sai ƒëi·ªÉn h√¨nh (0.2^2 = 0.04)
                    "$-2 > -\\sqrt{3}$", // Sai (-2 < -1.73)
                    "$33,3(5) < 33,(35)$", // Sai (33.355... > 33.353...)
                    "$3,25(75) < 3,2(57)$", // Sai (th·ª±c ra b·∫±ng nhau: 3.257575...)
                    "$\\sqrt{2} > 1,5$" // Sai (1.41 < 1.5)
                ];
                const distractors = shuffleArray(falseStmts).slice(0, 3);
                options = shuffleArray([correct, ...distractors]);
                
                explanation = `Kh·∫≥ng ƒë·ªãnh ƒë√∫ng l√†: $${selectedCorrect.tex}$. <br><b>Gi·∫£i th√≠ch chi ti·∫øt:</b><br>${selectedCorrect.expl}`;
                
                // N·∫øu c√¢u ƒë√∫ng l√† c√¢u g√†i A, gi·∫£i th√≠ch th√™m v·ªÅ c√°c c√¢u nhi·ªÖu n·∫øu c·∫ßn
                if(options.includes("$33,3(5) < 33,(35)$")) {
                     explanation += `<br><br> L∆∞u √Ω: $33,3(5) = 33,3555...$ v√† $33,(35) = 33,3535...$ (s·ªë 5 > 3 ·ªü h√†ng ph·∫ßn ngh√¨n n√™n v·∫ø tr√°i l·ªõn h∆°n).`;
                }

            } else if (type === 3) {
                // D·∫°ng 3: T√¨m c√¢u SAI (C√°c c√¢u g√†i ƒë·∫∑c bi·ªát)
                typeLabel = "C√¢u 5: T√¨m kh·∫≥ng ƒë·ªãnh SAI";
                question = "Trong c√°c kh·∫≥ng ƒë·ªãnh sau, kh·∫≥ng ƒë·ªãnh n√†o l√† <b>SAI</b>?";
                
                // T·∫≠p h·ª£p c√°c c√¢u SAI (ƒê√°p √°n c·∫ßn ch·ªçn)
                const falseStmts = [
                    {
                        tex: "3,25(75) < 3,2(57)", 
                        expl: "Khai tri·ªÉn:<br> $VT = 3,25(75) = 3,257575...$ <br> $VP = 3,2(57) = 3,257575...$ <br>Hai s·ªë n√†y <b>b·∫±ng nhau</b>, n√™n d·∫•u $<$ l√† SAI."
                    },
                    {
                        tex: "\\sqrt{0,4} = 0,2", 
                        expl: "V√¨ $0,2^2 = 0,04 \\ne 0,4$. Gi√° tr·ªã ƒë√∫ng l√† $\\sqrt{0,4} \\approx 0,632$."
                    },
                    {
                        tex: "-2 > -\\sqrt{3}", 
                        expl: "V√¨ $\\sqrt{3} \\approx 1,73$ n√™n $-2 < -1,73$. Kh·∫≥ng ƒë·ªãnh $-2 > -\\sqrt{3}$ l√† SAI."
                    },
                    {
                        tex: "33,3(5) < 33,(35)",
                        expl: "Khai tri·ªÉn:<br> $VT = 33,3555...$ <br> $VP = 33,3535...$ <br>So s√°nh h√†ng ph·∫ßn ngh√¨n: $5 > 3$ n√™n $VT > VP$. D·∫•u $<$ l√† SAI."
                    }
                ];
                const selectedFalse = falseStmts[randomInt(0, falseStmts.length-1)];
                correct = `$${selectedFalse.tex}$`;

                // C√°c c√¢u ƒê√öNG l√†m nhi·ªÖu
                const trueStmts = [
                    "$-0,(15) > -0,(16)$",
                    "$\\sqrt{2} < \\frac{3}{2}$", // 1.41 < 1.5
                    "$-\\pi > -3,15$",
                    "$-\\sqrt{5} < -2,2$"
                ];
                const distractors = shuffleArray(trueStmts).slice(0, 3);
                options = shuffleArray([correct, ...distractors]);
                explanation = `Kh·∫≥ng ƒë·ªãnh SAI l√†: $${selectedFalse.tex}$. <br><b>Gi·∫£i th√≠ch:</b> ${selectedFalse.expl}`;

            } else {
                // D·∫°ng 4: So s√°nh tr·ª±c ti·∫øp c∆° b·∫£n
                typeLabel = "C√¢u 5: So s√°nh s·ªë th·ª±c";
                const pairs = [
                    {s1: "3,92", s2: "3,(4)", res: ">"},
                    {s1: "-\\sqrt{2}", s2: "-1,4143", res: ">"},
                    {s1: "0,(31)", s2: "0,3(12)", res: ">"},
                    {s1: "-1,5", s2: "-1,50001", res: ">"}
                ];
                const p = pairs[randomInt(0, pairs.length-1)];
                question = `Kh·∫≥ng ƒë·ªãnh n√†o sau ƒë√¢y l√† ƒë√∫ng?`;
                correct = `$${p.s1} ${p.res} ${p.s2}$`;
                const opInverse = p.res === ">" ? "<" : ">";
                options = shuffleArray([
                    correct,
                    `$${p.s1} ${opInverse} ${p.s2}$`,
                    `$${p.s1} = ${p.s2}$`,
                    `$|${p.s1}| ${opInverse} |${p.s2}|$`
                ]);
                explanation = `ƒê√°p √°n ƒë√∫ng l√† $${p.s1} ${p.res} ${p.s2}$. (B·∫°n c√≥ th·ªÉ ki·ªÉm tra b·∫±ng c√°ch khai tri·ªÉn s·ªë th·∫≠p ph√¢n).`;
            }
            return { typeLabel, text: question, correct, options, explanation };
        };

        // ================= C√ÇU 6: GI√Å TR·ªä TUY·ªÜT ƒê·ªêI =================
        const generateQuestion6 = () => {
            const type = randomInt(1, 4);
            let question, correct, options, explanation, typeLabel;

            if (type === 1) {
                // D·∫°ng 1: Kh·∫≥ng ƒë·ªãnh SAI/ƒê√öNG v·ªÅ GTTƒê
                typeLabel = "C√¢u 6: L√Ω thuy·∫øt GTTƒê";
                question = "Ch·ªçn kh·∫≥ng ƒë·ªãnh <b>SAI</b> trong c√°c kh·∫≥ng ƒë·ªãnh sau:";
                const falseStmts = [
                    {tex: "|-1,(4)| = -1,(4)", expl: "Gi√° tr·ªã tuy·ªát ƒë·ªëi kh√¥ng bao gi·ªù √¢m ($|-1,(4)| = 1,(4)$)"},
                    {tex: "|-5| = -5", expl: "Gi√° tr·ªã tuy·ªát ƒë·ªëi c·ªßa -5 ph·∫£i l√† 5"},
                    {tex: "|x| < 0", expl: "Gi√° tr·ªã tuy·ªát ƒë·ªëi lu√¥n l·ªõn h∆°n ho·∫∑c b·∫±ng 0"},
                    {tex: "-|\\sqrt{3}| = \\sqrt{3}", expl: "$-|\\sqrt{3}| = -\\sqrt{3}$ (l√† s·ªë √¢m)"}
                ];
                const item = falseStmts[randomInt(0, falseStmts.length-1)];
                correct = `$${item.tex}$`;
                
                const trueStmts = [
                    "$|-3,5| = 3,5$",
                    "$-|-\\sqrt{2}| = -\\sqrt{2}$",
                    "$-|\\sqrt{3}| = -\\sqrt{3}$",
                    "$|0| = 0$"
                ];
                const distractors = shuffleArray(trueStmts).slice(0, 3);
                options = shuffleArray([correct, ...distractors]);
                explanation = `Kh·∫≥ng ƒë·ªãnh sai l√† $${item.tex}$. <br>Gi·∫£i th√≠ch: ${item.expl}.`;

            } else if (type === 2) {
                // D·∫°ng 2: T√¨m x bi·∫øt |x|=k
                typeLabel = "C√¢u 6: T√¨m x";
                const vals = [4, 9, 16, 25, 0.25, "1/4"];
                const a = vals[randomInt(0, vals.length-1)];
                
                question = `S·ªë n√†o d∆∞·ªõi ƒë√¢y c√≥ gi√° tr·ªã tuy·ªát ƒë·ªëi b·∫±ng $${a}$ (nghƒ©a l√† t√¨m $x$ th·ªèa $|x|=${a}$)?`;
                correct = `$${a}$ v√† $-${a}$`;
                options = shuffleArray([
                    `$${a}$ v√† $-${a}$`,
                    `Ch·ªâ $${a}$`,
                    `Ch·ªâ $-${a}$`,
                    `$${typeof a === 'number' ? a*a : a}$`
                ]);
                explanation = `C√≥ hai s·ªë th·ª±c ƒë·ªëi nhau c√≥ c√πng gi√° tr·ªã tuy·ªát ƒë·ªëi l√† $x$ v√† $-x$. Do ƒë√≥ $x = \\pm ${a}$.`;

            } else if (type === 3) {
                // D·∫°ng 3: T√≠nh to√°n GTTƒê
                typeLabel = "C√¢u 6: T√≠nh GTTƒê";
                const num = (Math.random() * 10).toFixed(2).replace('.', ',');
                const isNeg = Math.random() < 0.5;
                const valStr = isNeg ? `-${num}` : `${num}`;
                question = `Gi√° tr·ªã tuy·ªát ƒë·ªëi c·ªßa $${valStr}$ l√†:`;
                correct = `${num}`;
                options = shuffleArray([`${num}`, `-${num}`, `0`, `$\\pm ${num}$`]);
                explanation = `Gi√° tr·ªã tuy·ªát ƒë·ªëi c·ªßa m·ªôt s·ªë lu√¥n kh√¥ng √¢m. $|${valStr}| = ${num}$.`;

            } else {
                // D·∫°ng 4: Bi·ªÉu th·ª©c GTTƒê
                typeLabel = "C√¢u 6: Bi·ªÉu th·ª©c GTTƒê";
                const a = randomInt(1, 5);
                const b = randomInt(1, 5);
                const op = Math.random() < 0.5 ? "+" : "-";
                question = `Gi√° tr·ªã c·ªßa bi·ªÉu th·ª©c $M = |-${a}| ${op} |${Math.random() < 0.5 ? '-' : ''}${b}|$ l√†:`;
                const res = op === "+" ? a + b : a - b;
                correct = `${res}`;
                const w1 = op === "+" ? `${-a + b}` : `${-a - b}`;
                const w2 = `${res * -1}`;
                const w3 = `${res + 2}`;
                options = shuffleArray([correct, w1, w2, w3]);
                options = [...new Set(options)];
                explanation = `Ta c√≥ $|-${a}| = ${a}$ v√† $|\\pm${b}| = ${b}$. Thay v√†o: $M = ${a} ${op} ${b} = ${res}$.`;
            }
            return { typeLabel, text: question, correct, options, explanation };
        };

        // --- CORE LOGIC ---
        const showLoading = () => {
            const loader = document.getElementById('question-loader');
            loader.classList.remove('hidden-loader');
        };

        const hideLoading = () => {
            const loader = document.getElementById('question-loader');
            loader.classList.add('hidden-loader');
        };

        const loadQuestion = () => {
            showLoading();
            const contentWrapper = document.getElementById('main-content-wrapper');
            contentWrapper.classList.remove('content-visible');

            state.isAnswered = false;
            let qData;
            
            // Mode selection logic
            let selectedMode = state.mode;
            if (state.mode === 'all') {
                const r = Math.random();
                if (r < 0.33) selectedMode = 'q4';
                else if (r < 0.66) selectedMode = 'q5';
                else selectedMode = 'q6';
            }

            if (selectedMode === 'q4') qData = generateQuestion4();
            else if (selectedMode === 'q5') qData = generateQuestion5();
            else qData = generateQuestion6();

            state.currentQuestion = qData;

            // Render content
            document.getElementById('question-type-badge').innerText = qData.typeLabel;
            document.getElementById('question-text').innerHTML = qData.text;
            
            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = '';
            
            qData.options.forEach((opt, index) => {
                const btn = document.createElement('button');
                btn.className = "btn-option w-full bg-indigo-50 hover:bg-indigo-100 text-indigo-900 border border-indigo-200 p-4 rounded-xl text-lg font-semibold shadow-sm text-left flex items-center group";
                btn.dataset.value = opt; 

                const labels = ['A', 'B', 'C', 'D'];
                btn.innerHTML = `<span class="inline-block w-8 h-8 rounded-full bg-indigo-200 text-center leading-8 mr-3 text-indigo-800 font-bold shadow-sm group-hover:bg-indigo-600 group-hover:text-white transition flex-shrink-0">${labels[index]}</span> <span>${opt}</span>`;
                btn.onclick = () => checkAnswer(opt, btn);
                optionsContainer.appendChild(btn);
            });

            // Reset UI
            document.getElementById('feedback-msg').className = "hidden";
            document.getElementById('explanation-area').className = "hidden mb-6 p-4 bg-yellow-50 border-l-4 border-yellow-400 rounded-r-lg text-gray-700 text-sm md:text-base fade-in";
            document.getElementById('explanation-area').innerHTML = '';
            
            const btnNext = document.getElementById('btn-next');
            btnNext.innerHTML = 'B·ªè qua <i class="fas fa-forward ml-2"></i>';
            btnNext.className = "bg-white border border-gray-300 text-gray-600 px-6 py-2 rounded-full font-bold hover:bg-gray-100 transition flex items-center ml-auto shadow-sm";

            // MathJax Rendering
            if (window.MathJax && window.MathJax.typesetPromise) {
                MathJax.typesetPromise([contentWrapper]).then(() => {
                    setTimeout(() => {
                        hideLoading();
                        contentWrapper.classList.add('content-visible');
                    }, 150);
                });
            } else {
                setTimeout(() => {
                    hideLoading();
                    contentWrapper.classList.add('content-visible');
                }, 200);
            }
        };

        const checkAnswer = (selectedVal, btnElement) => {
            if (state.isAnswered) return;
            state.isAnswered = true;

            const isCorrect = selectedVal == state.currentQuestion.correct;
            const feedbackEl = document.getElementById('feedback-msg');
            const explArea = document.getElementById('explanation-area');
            const overlay = document.getElementById('feedback-overlay');
            const icon = document.getElementById('feedback-icon');
            const title = document.getElementById('feedback-title');
            const msg = document.getElementById('feedback-message');
            const detail = document.getElementById('feedback-detail');

            const allBtns = document.querySelectorAll('.btn-option');
            allBtns.forEach(b => {
                b.disabled = true;
                b.classList.add('opacity-70');
            });

            // Highlight Correct
            const correctBtn = Array.from(allBtns).find(b => b.dataset.value === state.currentQuestion.correct);
            if (correctBtn) {
                correctBtn.classList.remove('bg-indigo-50', 'text-indigo-900', 'border-indigo-200', 'opacity-70');
                correctBtn.classList.add('bg-green-100', 'text-green-800', 'border-green-600', 'border-2', 'opacity-100');
                const span = correctBtn.querySelector('span');
                if(span) {
                    span.classList.remove('bg-indigo-200', 'text-indigo-800');
                    span.classList.add('bg-green-600', 'text-white');
                }
            }

            if (isCorrect) {
                btnElement.classList.add('bg-green-500', 'text-white', 'pop', 'opacity-100');
                btnElement.classList.remove('bg-green-100', 'text-green-800'); 
                const span = btnElement.querySelector('span');
                if(span) span.classList.add('bg-white', 'text-green-600');

                feedbackEl.innerHTML = `<span class="text-green-600"><i class="fas fa-check-circle"></i> Ch√≠nh x√°c!</span>`;
                feedbackEl.className = "text-lg font-bold block pl-2 animate-bounce";
                
                state.streak++;
                state.correct++;
            } else {
                btnElement.classList.add('bg-red-500', 'text-white', 'border-red-600', 'shake', 'opacity-100');
                btnElement.classList.remove('bg-indigo-50');
                const span = btnElement.querySelector('span');
                if(span) span.classList.add('bg-white', 'text-red-600');
                
                feedbackEl.innerHTML = `<span class="text-red-500"><i class="fas fa-times-circle"></i> Ch∆∞a ƒë√∫ng!</span>`;
                feedbackEl.className = "text-lg font-bold block pl-2";

                state.streak = 0;
                state.wrong++;

                // Modal Info
                icon.innerHTML = '<i class="fas fa-times-circle text-red-500"></i>';
                title.innerText = "Ch∆∞a ch√≠nh x√°c";
                title.className = "text-2xl font-bold mb-2 text-red-600";
                msg.innerHTML = `ƒê√°p √°n ƒë√∫ng l√†: <br><span class="text-green-600 font-bold text-xl mt-2 block">${state.currentQuestion.correct}</span>`;
                
                setTimeout(() => { 
                    overlay.classList.remove('hidden'); 
                    if (window.MathJax) MathJax.typesetPromise([overlay]);
                }, 600);
            }

            renderStats();

            explArea.innerHTML = `<p class="font-bold text-indigo-800 mb-1"><i class="fas fa-lightbulb text-yellow-500 mr-2"></i>Gi·∫£i th√≠ch:</p> ${state.currentQuestion.explanation}`;
            explArea.classList.remove('hidden');
            detail.innerHTML = state.currentQuestion.explanation;

            const btnNext = document.getElementById('btn-next');
            btnNext.innerHTML = `C√¢u ti·∫øp theo <i class="fas fa-arrow-right ml-2"></i>`;
            btnNext.className = "bg-indigo-600 text-white px-6 py-2 rounded-full font-bold hover:bg-indigo-700 transition flex items-center ml-auto shadow-lg transform scale-105";

            if (window.MathJax) MathJax.typesetPromise([explArea]);
        };

        const handleNextClick = (forceSkip = false) => {
            if (!state.isAnswered && !forceSkip) {
                state.streak = 0;
                state.skipped++;
                renderStats();
            }
            loadQuestion();
        };

        const renderStats = () => {
            const container = document.getElementById('stats-container');
            container.innerHTML = `
                <div class="flex flex-col items-center">
                    <span class="text-xs text-gray-500 uppercase font-bold">Chu·ªói th·∫Øng üî•</span>
                    <span class="text-3xl font-extrabold ${state.streak > 2 ? 'text-orange-500 animate-pulse' : 'text-gray-800'}">
                        ${state.streak}
                    </span>
                </div>
                <div class="flex flex-col items-center border-l">
                    <span class="text-xs text-gray-500 uppercase font-bold">ƒê√∫ng</span>
                    <span class="text-xl font-bold text-green-600">${state.correct}</span>
                </div>
                <div class="flex flex-col items-center border-l">
                    <span class="text-xs text-gray-500 uppercase font-bold">Sai</span>
                    <span class="text-xl font-bold text-red-500">${state.wrong}</span>
                </div>
                <div class="flex flex-col items-center border-l">
                    <span class="text-xs text-gray-500 uppercase font-bold">B·ªè qua</span>
                    <span class="text-xl font-bold text-gray-400">${state.skipped}</span>
                </div>
            `;
        };

        const setMode = (mode) => {
            state.mode = mode;
            ['all', 'q4', 'q5', 'q6'].forEach(m => {
                const btn = document.getElementById(`btn-mode-${m}`);
                if (m === mode) {
                    btn.className = "mode-active py-2 px-2 rounded-lg font-bold border-2 shadow-sm flex flex-col items-center justify-center transition-transform transform scale-105";
                } else {
                    btn.className = "mode-inactive py-2 px-2 rounded-lg font-bold border-2 shadow-sm flex flex-col items-center justify-center transition-transform";
                }
            });
            handleNextClick(true);
        };

        const closeModal = () => {
            document.getElementById('feedback-overlay').classList.add('hidden');
        };

        window.onload = () => {
            renderStats();
            loadQuestion();
        }
    </script>
</body>
</html>