<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C√¥ng C·ª• H√¨nh H·ªçc Ph·∫≥ng 6 - CTST</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f9ff;
        }
        .nav-btn.active {
            background-color: #0ea5e9;
            color: white;
            border-color: #0ea5e9;
        }
        .hidden {
            display: none;
        }
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1; 
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8; 
        }
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
            -webkit-appearance: none; 
            margin: 0; 
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col text-gray-800">

    <!-- Header -->
    <header class="bg-white shadow-md sticky top-0 z-50">
        <div class="max-w-6xl mx-auto px-4 py-3">
            <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                <div class="flex items-center gap-3 w-full md:w-auto">
                    <a href="cong-cu.html" class="text-gray-500 hover:text-blue-600 transition-colors" title="Quay l·∫°i danh s√°ch c√¥ng c·ª•">
                        <i class="fa-solid fa-arrow-left text-xl"></i>
                    </a>
                    <div class="bg-blue-600 text-white p-2 rounded-lg">
                        <i class="fa-solid fa-shapes text-xl"></i>
                    </div>
                    <div>
                        <h1 class="text-lg md:text-xl font-bold text-gray-800 leading-tight">H√¨nh H·ªçc Ph·∫≥ng 6</h1>
                        <p class="text-xs text-gray-500 hidden md:block">Ch√¢n Tr·ªùi S√°ng T·∫°o - HK1</p>
                    </div>
                </div>
                
                <nav class="flex gap-2 w-full md:w-auto overflow-x-auto pb-1 md:pb-0">
                    <button onclick="switchTab('learn')" id="btn-learn" class="nav-btn active whitespace-nowrap px-4 py-2 rounded-full border border-gray-300 font-medium text-sm transition-colors hover:bg-blue-50 text-gray-700">
                        <i class="fa-solid fa-book-open mr-1"></i> <span class="hidden sm:inline">L√Ω Thuy·∫øt</span>
                    </button>
                    <button onclick="switchTab('calc')" id="btn-calc" class="nav-btn whitespace-nowrap px-4 py-2 rounded-full border border-gray-300 font-medium text-sm transition-colors hover:bg-blue-50 text-gray-700">
                        <i class="fa-solid fa-calculator mr-1"></i> T√≠nh To√°n
                    </button>
                    <button onclick="switchTab('quiz')" id="btn-quiz" class="nav-btn whitespace-nowrap px-4 py-2 rounded-full border border-gray-300 font-medium text-sm transition-colors hover:bg-blue-50 text-gray-700">
                        <i class="fa-solid fa-puzzle-piece mr-1"></i> <span class="hidden sm:inline">Luy·ªán T·∫≠p</span>
                    </button>
                </nav>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow container max-w-6xl mx-auto p-4">

        <!-- TAB: LEARN (L√Ω Thuy·∫øt) -->
        <div id="tab-learn" class="block fade-in">
            <div class="grid grid-cols-1 md:grid-cols-12 gap-6">
                <!-- Sidebar Menu -->
                <div class="md:col-span-4 lg:col-span-3 space-y-2 overflow-y-auto max-h-[calc(100vh-140px)] pr-2" id="shape-menu">
                    <!-- Menu items generated by JS -->
                </div>

                <!-- Detail View -->
                <div class="md:col-span-8 lg:col-span-9">
                    <div class="bg-white rounded-2xl shadow-lg border border-blue-100 overflow-hidden sticky top-24">
                        <div class="bg-blue-600 p-4 text-white flex justify-between items-center">
                            <h2 class="text-xl font-bold" id="detail-title">Ch·ªçn m·ªôt h√¨nh ƒë·ªÉ h·ªçc</h2>
                            <i class="fa-regular fa-lightbulb text-yellow-300 text-2xl"></i>
                        </div>
                        
                        <div class="p-6">
                            <!-- Image Area -->
                            <div class="flex justify-center mb-6 bg-gray-50 rounded-xl p-4 border border-dashed border-gray-300 min-h-[200px] items-center relative">
                                <div id="detail-visual" class="w-full h-full flex justify-center items-center">
                                    <p class="text-gray-400 italic">H√¨nh ·∫£nh minh h·ªça s·∫Ω hi·ªán ·ªü ƒë√¢y</p>
                                </div>
                            </div>

                            <!-- Info Grid -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6" id="detail-content" style="opacity: 0.5; pointer-events: none;">
                                <!-- Recognition -->
                                <div class="bg-orange-50 p-4 rounded-xl border border-orange-100">
                                    <h3 class="text-orange-700 font-bold mb-3 flex items-center gap-2">
                                        <i class="fa-solid fa-eye"></i> D·∫•u hi·ªáu nh·∫≠n bi·∫øt
                                    </h3>
                                    <ul class="text-sm text-gray-700 space-y-2 list-disc pl-4" id="detail-features">
                                        <li>...</li>
                                    </ul>
                                </div>

                                <!-- Formulas -->
                                <div class="bg-green-50 p-4 rounded-xl border border-green-100">
                                    <h3 class="text-green-700 font-bold mb-3 flex items-center gap-2">
                                        <i class="fa-solid fa-calculator"></i> C√¥ng th·ª©c
                                    </h3>
                                    <div class="space-y-4">
                                        <div>
                                            <span class="text-xs font-bold text-gray-500 uppercase">Chu vi (C)</span>
                                            <div class="text-lg font-mono text-gray-800 bg-white px-2 py-1 rounded border border-green-100 mt-1" id="detail-perimeter">...</div>
                                        </div>
                                        <div>
                                            <span class="text-xs font-bold text-gray-500 uppercase">Di·ªán t√≠ch (S)</span>
                                            <div class="text-lg font-mono text-gray-800 bg-white px-2 py-1 rounded border border-green-100 mt-1" id="detail-area">...</div>
                                        </div>
                                        <!-- Derived Formulas Section -->
                                        <div id="derived-container" class="hidden border-t border-green-200 pt-3">
                                            <span class="text-xs font-bold text-teal-600 uppercase flex items-center gap-1">
                                                <i class="fa-solid fa-rotate"></i> T√≠nh ng∆∞·ª£c (Suy r·ªông)
                                            </span>
                                            <div class="text-sm font-mono text-teal-800 mt-1 bg-white p-2 rounded border border-teal-100" id="detail-derived">...</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB: CALCULATOR (C√¥ng C·ª• T√≠nh) -->
        <div id="tab-calc" class="hidden fade-in">
            <div class="grid grid-cols-1 md:grid-cols-12 gap-6">
                <!-- Shape Selector for Calculator -->
                <div class="md:col-span-4 lg:col-span-3 space-y-2 overflow-y-auto max-h-[calc(100vh-140px)] pr-2" id="calc-menu">
                    <!-- Generated by JS -->
                </div>

                <!-- Calculator Interface -->
                <div class="md:col-span-8 lg:col-span-9">
                    <div class="bg-white rounded-2xl shadow-lg border border-indigo-100 overflow-hidden sticky top-24">
                        <div class="bg-indigo-600 p-4 text-white flex justify-between items-center">
                            <h2 class="text-xl font-bold flex items-center gap-2">
                                <i class="fa-solid fa-calculator"></i> <span id="calc-title">Ch·ªçn h√¨nh ƒë·ªÉ t√≠nh</span>
                            </h2>
                        </div>

                        <div class="p-6">
                            <!-- Mode Selector -->
                            <div class="flex justify-center mb-6 bg-gray-100 p-1 rounded-lg inline-flex w-full md:w-auto">
                                <button onclick="setCalcMode('forward')" id="btn-mode-forward" class="flex-1 md:flex-none px-6 py-2 rounded-md text-sm font-bold transition-all bg-white text-indigo-600 shadow-sm">
                                    T√≠nh Xu√¥i (T√¨m S, C)
                                </button>
                                <button onclick="setCalcMode('reverse')" id="btn-mode-reverse" class="flex-1 md:flex-none px-6 py-2 rounded-md text-sm font-bold transition-all text-gray-500 hover:text-gray-700">
                                    T√≠nh Ng∆∞·ª£c (T√¨m c·∫°nh)
                                </button>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-start">
                                <!-- Inputs -->
                                <div>
                                    <h3 class="text-sm font-bold text-gray-500 uppercase mb-3">Nh·∫≠p d·ªØ li·ªáu:</h3>
                                    <div id="calc-inputs" class="space-y-4">
                                        <p class="text-gray-400 italic">Vui l√≤ng ch·ªçn h√¨nh b√™n tr√°i.</p>
                                    </div>
                                    <div class="mt-6 flex gap-2">
                                        <button onclick="calculate()" class="flex-1 bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg shadow transition-transform active:scale-95">
                                            T√≠nh K·∫øt Qu·∫£
                                        </button>
                                        <button onclick="resetCalc()" class="px-4 py-2 bg-gray-200 text-gray-600 rounded-lg hover:bg-gray-300">
                                            <i class="fa-solid fa-rotate-right"></i>
                                        </button>
                                    </div>
                                </div>

                                <!-- Results -->
                                <div class="bg-indigo-50 rounded-xl p-6 border border-indigo-100 h-full">
                                    <h3 class="text-sm font-bold text-indigo-800 uppercase mb-3">K·∫øt qu·∫£:</h3>
                                    <div id="calc-results" class="space-y-4">
                                        <!-- Result items -->
                                        <div class="text-center text-gray-400 py-4">K·∫øt qu·∫£ s·∫Ω hi·ªán ·ªü ƒë√¢y</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB: QUIZ (Luy·ªán T·∫≠p) -->
        <div id="tab-quiz" class="hidden fade-in">
            <div class="max-w-2xl mx-auto mt-4">
                <!-- Quiz Setup -->
                <div id="quiz-setup" class="bg-white rounded-2xl shadow-lg p-8 text-center border border-gray-100">
                    <div class="mb-6 animate-bounce">
                        <i class="fa-solid fa-graduation-cap text-6xl text-blue-500"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">Tr·∫Øc Nghi·ªám Ki·∫øn Th·ª©c</h2>
                    <p class="text-gray-600 mb-8">H·ªá th·ªëng s·∫Ω t·∫°o ng·∫´u nhi√™n 10 c√¢u h·ªèi v·ªÅ nh·∫≠n d·∫°ng h√¨nh v√† c√¥ng th·ª©c.</p>
                    <button onclick="startQuiz()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-10 rounded-full text-lg transition-transform hover:scale-105 shadow-xl shadow-blue-200">
                        B·∫Øt ƒë·∫ßu ngay
                    </button>
                </div>

                <!-- Quiz Interface -->
                <div id="quiz-interface" class="hidden bg-white rounded-2xl shadow-lg overflow-hidden border border-gray-100">
                    <div class="w-full bg-gray-200 h-1.5">
                        <div id="progress-bar" class="bg-green-500 h-1.5 transition-all duration-300" style="width: 0%"></div>
                    </div>
                    
                    <div class="p-6 md:p-8">
                        <div class="flex justify-between items-center mb-6">
                            <span class="text-sm font-bold text-gray-500">C√¢u <span id="current-q">1</span>/10</span>
                            <div class="bg-blue-100 text-blue-800 text-xs font-bold px-3 py-1 rounded-full flex items-center gap-1">
                                <i class="fa-solid fa-star text-yellow-500"></i> <span id="quiz-score">0</span>
                            </div>
                        </div>

                        <div class="mb-6 min-h-[100px]">
                            <h3 class="text-lg md:text-xl font-bold text-gray-800 mb-4" id="question-text">Loading...</h3>
                            <div id="question-visual" class="flex justify-center mb-4 hidden"></div>
                        </div>

                        <div class="grid grid-cols-1 gap-3" id="answer-options">
                            <!-- Options -->
                        </div>
                    </div>
                    
                    <div id="feedback-area" class="hidden p-4 bg-gray-50 border-t border-gray-100 text-center animate-fade-in">
                        <p id="feedback-text" class="font-bold text-lg mb-3"></p>
                        <button onclick="nextQuestion()" id="next-btn" class="bg-blue-600 text-white px-8 py-2 rounded-full font-medium hover:bg-blue-700 shadow-lg">C√¢u ti·∫øp theo <i class="fa-solid fa-arrow-right ml-2"></i></button>
                    </div>
                </div>

                <!-- Quiz Result -->
                <div id="quiz-result" class="hidden bg-white rounded-2xl shadow-lg p-8 text-center">
                    <div class="mb-4 text-6xl" id="result-icon">üèÜ</div>
                    <h2 class="text-3xl font-bold text-gray-800 mb-2">K·∫øt qu·∫£</h2>
                    <p class="text-xl text-gray-600 mb-6">B·∫°n tr·∫£ l·ªùi ƒë√∫ng <span id="final-score" class="font-bold text-blue-600">0</span>/10 c√¢u.</p>
                    <p id="result-message" class="text-gray-500 mb-8 italic">...</p>
                    <button onclick="resetQuiz()" class="bg-gray-100 hover:bg-gray-200 text-gray-800 font-bold py-3 px-8 rounded-full">
                        <i class="fa-solid fa-rotate-left mr-2"></i> L√†m l·∫°i
                    </button>
                </div>
            </div>
        </div>

    </main>

    <footer class="bg-white border-t border-gray-200 mt-8 py-6">
        <div class="container mx-auto px-4 text-center text-gray-500 text-xs md:text-sm">
            <p>S·∫£n ph·∫©m h·ªó tr·ª£ h·ªçc t·∫≠p m√¥n To√°n 6</p>
            <p class="mt-1">D·ªØ li·ªáu theo s√°ch Ch√¢n Tr·ªùi S√°ng T·∫°o (CTST)</p>
        </div>
    </footer>

    <!-- LOGIC -->
    <script>
        // --- DATA ---
        // Defines shapes, formulas, and calculation logic
        const shapesData = [
            {
                id: 'tam_giac_deu',
                name: 'Tam gi√°c ƒë·ªÅu',
                icon: 'fa-play fa-rotate-270', 
                color: 'text-red-500',
                features: ['3 c·∫°nh b·∫±ng nhau', '3 g√≥c b·∫±ng nhau (60¬∞)'],
                formulas: {
                    perimeter: '$$C = 3a$$',
                    area: 'Ch∆∞a c√≥ c√¥ng th·ª©c t·ªïng qu√°t ·ªü l·ªõp 6 (th∆∞·ªùng t√≠nh b·∫±ng c√°ch ƒë·∫øm √¥ ho·∫∑c chi·ªÅu cao cho tr∆∞·ªõc).',
                    derived: '$$a = C : 3$$',
                    note: '\\(a\\): ƒë·ªô d√†i c·∫°nh.'
                },
                svg: `<svg viewBox="0 0 100 100" class="w-32 h-32 drop-shadow-md"><polygon points="50,10 90,80 10,80" fill="#fee2e2" stroke="#ef4444" stroke-width="3"/><text x="45" y="95" class="text-xs font-bold text-red-600">a</text></svg>`,
                calc: {
                    inputs: [{id: 'a', label: 'C·∫°nh (a)'}],
                    forward: (vals) => ({ C: 3 * vals.a, S: null }), // S is complex for grade 6
                    reverse: (vals) => ({ a: vals.C ? vals.C / 3 : null }) // Only from C
                }
            },
            {
                id: 'hinh_vuong',
                name: 'H√¨nh vu√¥ng',
                icon: 'fa-square',
                color: 'text-blue-500',
                features: ['4 c·∫°nh b·∫±ng nhau', '4 g√≥c vu√¥ng', '2 ƒë∆∞·ªùng ch√©o b·∫±ng nhau'],
                formulas: {
                    perimeter: '$$C = 4a$$',
                    area: '$$S = a^2$$ (hay $$a \\times a$$)',
                    derived: '$$a = C : 4$$<br>$$a = \\sqrt{S}$$ (t√¨m s·ªë n√†o nh√¢n v·ªõi ch√≠nh n√≥ b·∫±ng S)',
                    note: '\\(a\\): c·∫°nh h√¨nh vu√¥ng.'
                },
                svg: `<svg viewBox="0 0 100 100" class="w-32 h-32 drop-shadow-md"><rect x="20" y="20" width="60" height="60" fill="#dbeafe" stroke="#3b82f6" stroke-width="3"/><text x="45" y="95" class="text-xs font-bold text-blue-600">a</text></svg>`,
                calc: {
                    inputs: [{id: 'a', label: 'C·∫°nh (a)'}],
                    forward: (vals) => ({ C: 4 * vals.a, S: vals.a * vals.a }),
                    reverse: (vals) => ({ a: vals.C ? vals.C / 4 : (vals.S ? Math.sqrt(vals.S) : null) })
                }
            },
            {
                id: 'luc_giac_deu',
                name: 'H√¨nh l·ª•c gi√°c ƒë·ªÅu',
                icon: 'fa-cube',
                color: 'text-purple-500',
                features: ['6 c·∫°nh b·∫±ng nhau', '6 g√≥c b·∫±ng nhau (120¬∞)', '3 ƒë∆∞·ªùng ch√©o ch√≠nh b·∫±ng nhau'],
                formulas: {
                    perimeter: '$$C = 6a$$',
                    area: 'Th∆∞·ªùng chia th√†nh 6 tam gi√°c ƒë·ªÅu ho·∫∑c h√¨nh thang c√¢n ƒë·ªÉ t√≠nh.',
                    derived: '$$a = C : 6$$',
                    note: '\\(a\\): c·∫°nh l·ª•c gi√°c.'
                },
                svg: `<svg viewBox="0 0 100 100" class="w-32 h-32 drop-shadow-md"><polygon points="50,10 85,30 85,70 50,90 15,70 15,30" fill="#f3e8ff" stroke="#a855f7" stroke-width="3"/><text x="45" y="98" class="text-xs font-bold text-purple-600">a</text></svg>`,
                calc: {
                    inputs: [{id: 'a', label: 'C·∫°nh (a)'}],
                    forward: (vals) => ({ C: 6 * vals.a, S: null }),
                    reverse: (vals) => ({ a: vals.C ? vals.C / 6 : null })
                }
            },
            {
                id: 'hinh_chu_nhat',
                name: 'H√¨nh ch·ªØ nh·∫≠t',
                icon: 'fa-stop',
                color: 'text-green-500',
                features: ['C√°c c·∫°nh ƒë·ªëi song song & b·∫±ng nhau', '4 g√≥c vu√¥ng', '2 ƒë∆∞·ªùng ch√©o b·∫±ng nhau'],
                formulas: {
                    perimeter: '$$C = 2(a + b)$$',
                    area: '$$S = a \\times b$$',
                    derived: '$$a = S : b$$ (ho·∫∑c $$b = S : a$$)<br>$$a = C : 2 - b$$',
                    note: '\\(a\\): chi·ªÅu d√†i, \\(b\\): chi·ªÅu r·ªông.'
                },
                svg: `<svg viewBox="0 0 100 100" class="w-40 h-28 drop-shadow-md"><rect x="10" y="25" width="80" height="50" fill="#dcfce7" stroke="#22c55e" stroke-width="3"/><text x="45" y="90" class="text-xs font-bold text-green-700">a</text><text x="2" y="55" class="text-xs font-bold text-green-700" style="writing-mode: tb;">b</text></svg>`,
                calc: {
                    inputs: [{id: 'a', label: 'Chi·ªÅu d√†i (a)'}, {id: 'b', label: 'Chi·ªÅu r·ªông (b)'}],
                    forward: (vals) => ({ C: 2*(vals.a + vals.b), S: vals.a * vals.b }),
                    reverse: null // Complex reverse logic handled manually below
                }
            },
            {
                id: 'hinh_thoi',
                name: 'H√¨nh thoi',
                icon: 'fa-diamond',
                color: 'text-yellow-500',
                features: ['4 c·∫°nh b·∫±ng nhau', '2 ƒë∆∞·ªùng ch√©o vu√¥ng g√≥c', 'C√°c c·∫°nh ƒë·ªëi song song'],
                formulas: {
                    perimeter: '$$C = 4a$$',
                    area: '$$S = \\frac{1}{2} m \\times n$$<br>(ho·∫∑c $$S = a \\times h$$)',
                    derived: '$$a = C : 4$$<br>$$m = 2S : n$$',
                    note: '\\(m, n\\): hai ƒë∆∞·ªùng ch√©o.'
                },
                svg: `<svg viewBox="0 0 100 100" class="w-32 h-32 drop-shadow-md"><polygon points="50,10 80,50 50,90 20,50" fill="#fef9c3" stroke="#eab308" stroke-width="3"/><line x1="50" y1="10" x2="50" y2="90" stroke="#b45309" stroke-dasharray="2" /><line x1="20" y1="50" x2="80" y2="50" stroke="#b45309" stroke-dasharray="2" /></svg>`,
                calc: {
                    inputs: [{id: 'm', label: 'ƒê∆∞·ªùng ch√©o 1 (m)'}, {id: 'n', label: 'ƒê∆∞·ªùng ch√©o 2 (n)'}, {id: 'a', label: 'C·∫°nh (a)', optional: true}],
                    forward: (vals) => ({ 
                        C: vals.a ? 4 * vals.a : null, 
                        S: (vals.m && vals.n) ? 0.5 * vals.m * vals.n : null 
                    }),
                    reverse: null
                }
            },
            {
                id: 'hinh_binh_hanh',
                name: 'H√¨nh b√¨nh h√†nh',
                icon: 'fa-square-full',
                color: 'text-teal-500',
                features: ['C·∫°nh ƒë·ªëi song song & b·∫±ng nhau', 'G√≥c ƒë·ªëi b·∫±ng nhau', 'Hai ƒë∆∞·ªùng ch√©o c·∫Øt nhau t·∫°i trung ƒëi·ªÉm'],
                formulas: {
                    perimeter: '$$C = 2(a + b)$$',
                    area: '$$S = a \\times h$$',
                    derived: '$$a = S : h$$<br>$$h = S : a$$',
                    note: '\\(a\\): c·∫°nh ƒë√°y, \\(h\\): chi·ªÅu cao.'
                },
                svg: `<svg viewBox="0 0 100 100" class="w-40 h-28 drop-shadow-md"><polygon points="20,80 90,80 80,30 10,30" fill="#ccfbf1" stroke="#14b8a6" stroke-width="3"/><line x1="10" y1="30" x2="10" y2="80" stroke="#0f766e" stroke-dasharray="2" /><text x="5" y="60" class="text-xs font-bold text-teal-800">h</text><text x="50" y="95" class="text-xs font-bold text-teal-800">a</text></svg>`,
                calc: {
                    inputs: [{id: 'a', label: 'C·∫°nh ƒë√°y (a)'}, {id: 'h', label: 'Chi·ªÅu cao (h)'}, {id: 'b', label: 'C·∫°nh b√™n (b)', optional: true}],
                    forward: (vals) => ({
                        C: (vals.a && vals.b) ? 2*(vals.a + vals.b) : null,
                        S: (vals.a && vals.h) ? vals.a * vals.h : null
                    }),
                    reverse: null
                }
            },
            {
                id: 'hinh_thang_can',
                name: 'H√¨nh thang c√¢n',
                icon: 'fa-archway', 
                color: 'text-indigo-500',
                features: ['Hai ƒë√°y song song', 'Hai c·∫°nh b√™n b·∫±ng nhau', 'Hai ƒë∆∞·ªùng ch√©o b·∫±ng nhau'],
                formulas: {
                    perimeter: '$$C = a + b + 2c$$',
                    area: '$$S = \\frac{(a + b) \\times h}{2}$$',
                    derived: '$$h = 2S : (a+b)$$<br>$$a+b = 2S : h$$',
                    note: '\\(a, b\\): hai ƒë√°y, \\(c\\): c·∫°nh b√™n, \\(h\\): chi·ªÅu cao.'
                },
                svg: `<svg viewBox="0 0 100 100" class="w-40 h-28 drop-shadow-md"><polygon points="20,80 80,80 65,30 35,30" fill="#e0e7ff" stroke="#6366f1" stroke-width="3"/><line x1="35" y1="30" x2="35" y2="80" stroke="#4338ca" stroke-dasharray="2" /><text x="50" y="25" class="text-xs font-bold text-indigo-800">b</text><text x="50" y="95" class="text-xs font-bold text-indigo-800">a</text></svg>`,
                calc: {
                    inputs: [{id: 'a', label: 'ƒê√°y l·ªõn (a)'}, {id: 'b', label: 'ƒê√°y nh·ªè (b)'}, {id: 'h', label: 'Chi·ªÅu cao (h)'}, {id: 'c', label: 'C·∫°nh b√™n (c)', optional: true}],
                    forward: (vals) => ({
                        C: (vals.a && vals.b && vals.c) ? vals.a + vals.b + 2*vals.c : null,
                        S: (vals.a && vals.b && vals.h) ? ((vals.a + vals.b)*vals.h)/2 : null
                    }),
                    reverse: null
                }
            }
        ];

        // --- GLOBAL STATE ---
        let currentCalcShape = 0;
        let calcMode = 'forward'; // 'forward' or 'reverse'

        // --- CORE FUNCTIONS ---
        function switchTab(tab) {
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active', 'bg-blue-600', 'text-white', 'border-blue-600'));
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.add('bg-white', 'text-gray-700'));
            
            const activeBtn = document.getElementById(`btn-${tab}`);
            activeBtn.classList.add('active', 'bg-blue-600', 'text-white', 'border-blue-600');
            activeBtn.classList.remove('bg-white', 'text-gray-700');

            ['learn', 'calc', 'quiz'].forEach(t => {
                const el = document.getElementById(`tab-${t}`);
                if (t === tab) {
                    el.classList.remove('hidden');
                    // Trigger render updates if needed
                    if (t === 'learn') renderLearnMenu();
                    if (t === 'calc') renderCalcMenu();
                } else {
                    el.classList.add('hidden');
                }
            });
        }

        // --- LEARN TAB LOGIC ---
        function renderLearnMenu() {
            const menu = document.getElementById('shape-menu');
            menu.innerHTML = shapesData.map((shape, index) => `
                <button onclick="selectLearnShape(${index})" 
                    class="w-full text-left p-3 rounded-xl border border-transparent hover:bg-white hover:border-blue-200 hover:shadow-sm transition-all flex items-center gap-3 group focus:outline-none focus:ring-2 focus:ring-blue-400 bg-white shadow-sm mb-2">
                    <div class="w-10 h-10 rounded-lg bg-gray-50 flex items-center justify-center group-hover:bg-blue-100 transition-colors">
                        <i class="fa-solid ${shape.icon} ${shape.color} text-lg"></i>
                    </div>
                    <span class="font-bold text-gray-700 group-hover:text-blue-700">${shape.name}</span>
                    <i class="fa-solid fa-chevron-right ml-auto text-gray-300 group-hover:text-blue-400 text-sm"></i>
                </button>
            `).join('');
        }

        function selectLearnShape(index) {
            const shape = shapesData[index];
            const content = document.getElementById('detail-content');
            content.style.opacity = '1';
            content.style.pointerEvents = 'auto';

            document.getElementById('detail-title').innerText = shape.name;
            document.getElementById('detail-visual').innerHTML = shape.svg;
            document.getElementById('detail-features').innerHTML = shape.features.map(f => `<li>${f}</li>`).join('');
            document.getElementById('detail-perimeter').innerHTML = shape.formulas.perimeter;
            document.getElementById('detail-area').innerHTML = shape.formulas.area;
            
            const derivedContainer = document.getElementById('derived-container');
            if (shape.formulas.derived) {
                derivedContainer.classList.remove('hidden');
                document.getElementById('detail-derived').innerHTML = shape.formulas.derived;
            } else {
                derivedContainer.classList.add('hidden');
            }
            if (window.MathJax) MathJax.typesetPromise();
        }

        // --- CALCULATOR TAB LOGIC ---
        function renderCalcMenu() {
            const menu = document.getElementById('calc-menu');
            menu.innerHTML = shapesData.map((shape, index) => `
                <button onclick="selectCalcShape(${index})" id="calc-btn-${index}"
                    class="calc-menu-btn w-full text-left p-3 rounded-xl border border-transparent hover:bg-white hover:border-indigo-200 hover:shadow-sm transition-all flex items-center gap-3 bg-white shadow-sm mb-2 ${index === currentCalcShape ? 'ring-2 ring-indigo-500 bg-indigo-50' : ''}">
                    <div class="w-8 h-8 rounded-lg bg-indigo-50 flex items-center justify-center">
                        <i class="fa-solid ${shape.icon} ${shape.color}"></i>
                    </div>
                    <span class="font-medium text-gray-700">${shape.name}</span>
                </button>
            `).join('');
            // Select default
            selectCalcShape(currentCalcShape || 0);
        }

        function setCalcMode(mode) {
            calcMode = mode;
            document.getElementById('btn-mode-forward').className = mode === 'forward' 
                ? 'flex-1 md:flex-none px-6 py-2 rounded-md text-sm font-bold transition-all bg-white text-indigo-600 shadow-sm ring-1 ring-indigo-200' 
                : 'flex-1 md:flex-none px-6 py-2 rounded-md text-sm font-bold transition-all text-gray-500 hover:text-gray-700 hover:bg-gray-200';
            
            document.getElementById('btn-mode-reverse').className = mode === 'reverse' 
                ? 'flex-1 md:flex-none px-6 py-2 rounded-md text-sm font-bold transition-all bg-white text-indigo-600 shadow-sm ring-1 ring-indigo-200' 
                : 'flex-1 md:flex-none px-6 py-2 rounded-md text-sm font-bold transition-all text-gray-500 hover:text-gray-700 hover:bg-gray-200';
            
            selectCalcShape(currentCalcShape); // Re-render inputs
        }

        function selectCalcShape(index) {
            currentCalcShape = index;
            const shape = shapesData[index];
            document.getElementById('calc-title').innerText = shape.name;
            
            // Highlight menu
            document.querySelectorAll('.calc-menu-btn').forEach(b => b.classList.remove('ring-2', 'ring-indigo-500', 'bg-indigo-50'));
            document.getElementById(`calc-btn-${index}`)?.classList.add('ring-2', 'ring-indigo-500', 'bg-indigo-50');

            const inputsDiv = document.getElementById('calc-inputs');
            inputsDiv.innerHTML = '';
            document.getElementById('calc-results').innerHTML = '<div class="text-center text-gray-400 py-4">Nh·∫≠p d·ªØ li·ªáu v√† nh·∫•n T√≠nh</div>';

            if (calcMode === 'forward') {
                // Render inputs based on shape data
                shape.calc.inputs.forEach(inp => {
                    const html = `
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">${inp.label} ${inp.optional ? '<span class="text-gray-400 text-xs">(kh√¥ng b·∫Øt bu·ªôc)</span>' : ''}</label>
                            <input type="number" id="inp_${inp.id}" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all" placeholder="Nh·∫≠p s·ªë...">
                        </div>
                    `;
                    inputsDiv.innerHTML += html;
                });
            } else {
                // Reverse Mode: Always S and C inputs
                let reverseNote = "";
                if (!shape.calc.reverse && !['hinh_chu_nhat', 'hinh_binh_hanh', 'hinh_thang_can', 'hinh_thoi'].includes(shape.id)) {
                    reverseNote = '<p class="text-red-500 text-sm mb-2"><i class="fa-solid fa-circle-info"></i> H√¨nh n√†y ch∆∞a h·ªó tr·ª£ t√≠nh ng∆∞·ª£c t·ª± ƒë·ªông ho·∫∑c qu√° ph·ª©c t·∫°p.</p>';
                }
                
                inputsDiv.innerHTML = reverseNote + `
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Di·ªán t√≠ch (S)</label>
                        <input type="number" id="inp_S" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none" placeholder="Nh·∫≠p di·ªán t√≠ch...">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Chu vi (C)</label>
                        <input type="number" id="inp_C" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none" placeholder="Nh·∫≠p chu vi...">
                    </div>
                `;
                
                // Specific inputs for specific shapes in reverse mode (e.g. need one side to find another)
                if (shape.id === 'hinh_chu_nhat') {
                    inputsDiv.innerHTML += `
                        <div class="mt-2 pt-2 border-t border-dashed border-gray-300">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Bi·∫øt tr∆∞·ªõc 1 c·∫°nh (ƒë·ªÉ t√¨m c·∫°nh kia)</label>
                            <input type="number" id="inp_known_side" class="w-full p-2 border border-gray-300 rounded-lg outline-none" placeholder="Nh·∫≠p ƒë·ªô d√†i...">
                        </div>
                    `;
                }
                 if (shape.id === 'hinh_binh_hanh') {
                    inputsDiv.innerHTML += `
                        <div class="mt-2 pt-2 border-t border-dashed border-gray-300">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Bi·∫øt chi·ªÅu cao (t√¨m ƒë√°y) ho·∫∑c ƒë√°y (t√¨m chi·ªÅu cao)</label>
                            <input type="number" id="inp_known_h_a" class="w-full p-2 border border-gray-300 rounded-lg outline-none" placeholder="Nh·∫≠p gi√° tr·ªã...">
                        </div>
                    `;
                }
            }
        }

        function calculate() {
            const shape = shapesData[currentCalcShape];
            const resultsDiv = document.getElementById('calc-results');
            
            try {
                if (calcMode === 'forward') {
                    // Gather inputs
                    const vals = {};
                    let hasVal = false;
                    shape.calc.inputs.forEach(inp => {
                        const val = parseFloat(document.getElementById(`inp_${inp.id}`).value);
                        if (!isNaN(val)) {
                            vals[inp.id] = val;
                            hasVal = true;
                        }
                    });

                    if (!hasVal) {
                        resultsDiv.innerHTML = '<p class="text-red-500">Vui l√≤ng nh·∫≠p √≠t nh·∫•t m·ªôt gi√° tr·ªã.</p>';
                        return;
                    }

                    const res = shape.calc.forward(vals);
                    renderResults(res);

                } else {
                    // Reverse Mode
                    const S = parseFloat(document.getElementById('inp_S').value);
                    const C = parseFloat(document.getElementById('inp_C').value);
                    let resHtml = '';

                    // Generic simple shapes (Square, Equilateral Triangle, Hexagon)
                    if (shape.calc.reverse) {
                        const res = shape.calc.reverse({S, C});
                        if (res && res.a !== null && res.a !== undefined) {
                            resHtml += resultItem('ƒê·ªô d√†i c·∫°nh (a)', res.a);
                        } else {
                             resHtml += '<p class="text-gray-500 text-sm">Ch∆∞a ƒë·ªß d·ªØ li·ªáu ƒë·ªÉ t√≠nh c·∫°nh.</p>';
                        }
                    } 
                    // Complex shapes logic
                    else if (shape.id === 'hinh_chu_nhat') {
                        const known = parseFloat(document.getElementById('inp_known_side').value);
                        if (!isNaN(known) && known > 0) {
                            if (!isNaN(S)) resHtml += resultItem('C·∫°nh c√≤n l·∫°i (t·ª´ S)', S / known);
                            if (!isNaN(C)) resHtml += resultItem('C·∫°nh c√≤n l·∫°i (t·ª´ C)', (C / 2) - known);
                        } else {
                            resHtml += '<p class="text-orange-500 text-sm">C·∫ßn nh·∫≠p th√™m ƒë·ªô d√†i 1 c·∫°nh ƒë√£ bi·∫øt.</p>';
                        }
                    }
                    else if (shape.id === 'hinh_binh_hanh') {
                         const known = parseFloat(document.getElementById('inp_known_h_a').value);
                         if(!isNaN(S) && !isNaN(known)) {
                             resHtml += resultItem('Gi√° tr·ªã c√≤n l·∫°i (ƒë√°y/chi·ªÅu cao)', S / known);
                         } else {
                             resHtml += '<p class="text-orange-500 text-sm">C·∫ßn nh·∫≠p Di·ªán t√≠ch v√† 1 th√†nh ph·∫ßn (ƒë√°y ho·∫∑c cao).</p>';
                         }
                    }
                    else {
                        resHtml += '<p class="text-gray-500 italic">Ch·ª©c nƒÉng t√≠nh ng∆∞·ª£c cho h√¨nh n√†y ƒëang c·∫≠p nh·∫≠t.</p>';
                    }

                    resultsDiv.innerHTML = resHtml || '<p class="text-red-500">Kh√¥ng t√≠nh ƒë∆∞·ª£c k·∫øt qu·∫£ n√†o. Ki·ªÉm tra l·∫°i d·ªØ li·ªáu.</p>';
                }
            } catch (e) {
                console.error(e);
                resultsDiv.innerHTML = '<p class="text-red-500">L·ªói t√≠nh to√°n.</p>';
            }
        }

        function resultItem(label, val) {
            if (val === null || val === undefined || isNaN(val) || val <= 0) return '';
            // Format number: Max 2 decimal places
            const formatted = Math.round(val * 100) / 100;
            return `
                <div class="bg-white p-3 rounded-lg border border-indigo-100 flex justify-between items-center shadow-sm">
                    <span class="text-sm text-gray-600 font-medium">${label}</span>
                    <span class="text-xl font-bold text-indigo-700">${formatted}</span>
                </div>
            `;
        }

        function renderResults(res) {
            let html = '';
            if (res.C !== null && res.C !== undefined) html += resultItem('Chu vi (C)', res.C);
            if (res.S !== null && res.S !== undefined) html += resultItem('Di·ªán t√≠ch (S)', res.S);
            
            if (html === '') html = '<p class="text-orange-500">Thi·∫øu d·ªØ li·ªáu ƒë·ªÉ t√≠nh to√°n.</p>';
            document.getElementById('calc-results').innerHTML = html;
        }

        function resetCalc() {
            document.querySelectorAll('#calc-inputs input').forEach(i => i.value = '');
            document.getElementById('calc-results').innerHTML = '<div class="text-center text-gray-400 py-4">ƒê√£ x√≥a d·ªØ li·ªáu</div>';
        }

        // --- QUIZ LOGIC (Gi·ªØ nguy√™n t·ª´ version tr∆∞·ªõc nh∆∞ng t·ªëi ∆∞u hi·ªÉn th·ªã) ---
        let currentQuestionIdx = 0;
        let score = 0;
        let quizData = [];

        function generateQuiz() {
            const questions = [];
            
            // Visual Questions
            shapesData.forEach(shape => {
                questions.push({
                    type: 'visual',
                    question: 'H√¨nh b√™n d∆∞·ªõi l√† h√¨nh g√¨?',
                    visual: shape.svg,
                    correct: shape.name,
                    options: getRandomOptions(shape.name, shapesData.map(s => s.name))
                });
            });

            // Formula Questions
            shapesData.forEach(shape => {
                if(!shape.formulas.area.includes('Ch∆∞a c√≥') && !shape.formulas.area.includes('Th∆∞·ªùng')) {
                    const cleanFormula = shape.formulas.area.split('$$')[1] || shape.formulas.area.split('<br>')[0];
                    questions.push({
                        type: 'text',
                        question: `C√¥ng th·ª©c t√≠nh <b>Di·ªán t√≠ch ${shape.name}</b> l√†?`,
                        correct: cleanFormula,
                        options: getRandomFormulas(shape.formulas.area, shapesData)
                    });
                }
            });

            return questions.sort(() => 0.5 - Math.random()).slice(0, 10);
        }

        function getRandomOptions(correct, all) {
            return [...all.filter(x => x !== correct).sort(() => 0.5 - Math.random()).slice(0, 3), correct].sort(() => 0.5 - Math.random());
        }

        function getRandomFormulas(correctAreaRaw, allData) {
            const extract = (s) => { const p = s.split('$$'); return p.length > 1 ? p[1] : s.split('<br>')[0]; };
            const correct = extract(correctAreaRaw);
            const others = allData.filter(s => !s.formulas.area.includes('Ch∆∞a c√≥') && !s.formulas.area.includes('Th∆∞·ªùng'))
                                  .map(s => extract(s.formulas.area)).filter(f => f !== correct)
                                  .sort(() => 0.5 - Math.random()).slice(0, 3);
            return [...others, correct].sort(() => 0.5 - Math.random());
        }

        function startQuiz() {
            score = 0;
            currentQuestionIdx = 0;
            quizData = generateQuiz();
            
            document.getElementById('quiz-setup').classList.add('hidden');
            document.getElementById('quiz-result').classList.add('hidden');
            document.getElementById('quiz-interface').classList.remove('hidden');
            showQuestion();
        }

        function showQuestion() {
            const q = quizData[currentQuestionIdx];
            document.getElementById('current-q').innerText = currentQuestionIdx + 1;
            document.getElementById('quiz-score').innerText = score;
            document.getElementById('progress-bar').style.width = `${((currentQuestionIdx) / 10) * 100}%`;
            
            document.getElementById('question-text').innerHTML = q.question;
            const visualDiv = document.getElementById('question-visual');
            
            if (q.type === 'visual') {
                visualDiv.innerHTML = q.visual;
                visualDiv.classList.remove('hidden');
            } else {
                visualDiv.classList.add('hidden');
            }

            const optsDiv = document.getElementById('answer-options');
            optsDiv.innerHTML = q.options.map(opt => {
                let displayOpt = opt;
                if ((opt.includes('\\') || opt.includes('^')) && !opt.includes('$$')) displayOpt = `\\(${opt}\\)`;
                return `<button onclick="checkAnswer(this, '${opt.replace(/'/g, "\\'")}')" class="option-btn w-full text-left p-4 rounded-xl border border-gray-200 hover:bg-blue-50 hover:border-blue-300 transition-all font-medium text-gray-700 bg-white shadow-sm hover:shadow-md flex justify-between items-center group">
                            <span>${displayOpt}</span>
                            <i class="fa-regular fa-circle text-gray-300 group-hover:text-blue-400"></i>
                        </button>`;
            }).join('');

            document.getElementById('feedback-area').classList.add('hidden');
            if (window.MathJax) MathJax.typesetPromise();
        }

        function checkAnswer(btn, value) {
            document.querySelectorAll('.option-btn').forEach(b => b.disabled = true);
            const q = quizData[currentQuestionIdx];
            
            if (value === q.correct) {
                btn.className = "option-btn w-full text-left p-4 rounded-xl border-2 border-green-500 bg-green-50 text-green-800 font-bold flex justify-between items-center shadow-md";
                btn.querySelector('i').className = "fa-solid fa-circle-check text-green-600 text-xl";
                score++;
                document.getElementById('feedback-text').innerHTML = `<span class="text-green-600"><i class="fa-solid fa-check-circle"></i> Ch√≠nh x√°c!</span>`;
            } else {
                btn.className = "option-btn w-full text-left p-4 rounded-xl border-2 border-red-500 bg-red-50 text-red-800 font-bold flex justify-between items-center shadow-md";
                btn.querySelector('i').className = "fa-solid fa-circle-xmark text-red-600 text-xl";
                
                let displayCorrect = q.correct;
                if ((q.correct.includes('\\') || q.correct.includes('^')) && !q.correct.includes('$$')) displayCorrect = `\\(${q.correct}\\)`;
                document.getElementById('feedback-text').innerHTML = `<span class="text-red-600">Sai r·ªìi! ƒê√°p √°n l√†: ${displayCorrect}</span>`;
            }
            document.getElementById('feedback-area').classList.remove('hidden');
            if (window.MathJax) MathJax.typesetPromise();
        }

        function nextQuestion() {
            currentQuestionIdx++;
            if (currentQuestionIdx < 10) showQuestion();
            else finishQuiz();
        }

        function finishQuiz() {
            document.getElementById('quiz-interface').classList.add('hidden');
            document.getElementById('quiz-result').classList.remove('hidden');
            document.getElementById('final-score').innerText = score;
            
            const p = score / 10;
            let msg = p >= 0.8 ? "Tuy·ªát v·ªùi! B·∫°n n·∫Øm r·∫•t v·ªØng ki·∫øn th·ª©c." : (p >= 0.5 ? "Kh√° t·ªët! H√£y √¥n l·∫°i c√°c c√¥ng th·ª©c ch∆∞a thu·ªôc nh√©." : "C·∫ßn c·ªë g·∫Øng th√™m! H√£y xem l·∫°i ph·∫ßn L√Ω Thuy·∫øt.");
            document.getElementById('result-message').innerText = msg;
        }

        function resetQuiz() {
            document.getElementById('quiz-result').classList.add('hidden');
            document.getElementById('quiz-setup').classList.remove('hidden');
        }

        // --- INIT ---
        document.addEventListener('DOMContentLoaded', () => {
            renderLearnMenu();
        });
    </script>
</body>
</html>