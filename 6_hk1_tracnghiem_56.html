<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>√în t·∫≠p Chinh Ph·ª•c To√°n 6 HK1 - C√¢u 5,6</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap');
        body {
            font-family: 'Nunito', sans-serif;
            background-color: #fdf2f8; /* Pink/Rose background for Geometry */
        }
        
        .option-card {
            transition: all 0.2s ease;
            touch-action: manipulation;
        }
        .option-card:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .option-card:active:not(:disabled) {
            transform: scale(0.98);
        }

        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        .shake {
            animation: shake 0.3s ease-in-out;
        }

        @keyframes pop {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        .pop {
            animation: pop 0.2s ease-out;
        }

        .streak-fire {
            color: #ef4444;
            animation: burn 0.5s infinite alternate;
        }
        @keyframes burn {
            from { text-shadow: 0 0 2px #fca5a5, 0 -2px 4px #f87171; }
            to { text-shadow: 0 0 4px #fca5a5, 0 -4px 8px #ef4444; }
        }

        /* SVG Shape Styles */
        .shape-svg {
            stroke: #4b5563;
            stroke-width: 3;
            fill: #e0f2fe; /* light blue fill */
            transition: all 0.3s ease;
        }
        .shape-container:hover .shape-svg {
            fill: #bae6fd;
            filter: drop-shadow(0 4px 3px rgb(0 0 0 / 0.07));
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center py-6 px-4">

    <!-- Header -->
    <header class="w-full max-w-4xl text-center mb-6">
        <h1 class="text-2xl md:text-3xl font-extrabold text-pink-700 mb-2 uppercase drop-shadow-sm">
            <i class="fas fa-shapes mr-2"></i>√în t·∫≠p Chinh Ph·ª•c To√°n 6 HK1 - C√¢u 5,6
        </h1>
        <p class="text-pink-600 font-medium">Ch·ªß ƒë·ªÅ: Tam gi√°c ƒë·ªÅu, H√¨nh vu√¥ng, L·ª•c gi√°c ƒë·ªÅu & C√°c h√¨nh m·ªü r·ªông</p>
    </header>

    <!-- Main Container -->
    <div class="w-full max-w-4xl flex flex-col gap-6">
        
        <!-- Control Panel (Category Selection) -->
        <div class="bg-white rounded-xl shadow-md p-4">
            <p class="text-sm text-gray-500 mb-3 font-bold text-center uppercase">Ch·ªçn d·∫°ng b√†i t·∫≠p</p>
            <div class="flex flex-wrap justify-center gap-2" id="category-buttons">
                <!-- Buttons injected by JS -->
            </div>
        </div>

        <!-- Stats Board -->
        <div class="bg-white rounded-xl shadow-md p-4 grid grid-cols-4 gap-2 text-center select-none" id="stats-container">
            <!-- Stats injected by JS -->
        </div>

        <!-- Question Area -->
        <div class="bg-white rounded-2xl shadow-xl overflow-hidden relative min-h-[350px] border-b-4 border-pink-500">
            
            <!-- Question Badge -->
            <div class="absolute top-0 left-0 bg-pink-100 text-pink-800 px-4 py-1 rounded-br-xl text-xs font-bold uppercase z-10" id="badge-topic">
                T·ªïng h·ª£p
            </div>

            <div id="question-container" class="p-6 md:p-8 pt-10">
                <!-- Content -->
                <div id="quiz-content" class="fade-in">
                    <!-- Visual Area for Shapes -->
                    <div id="visual-area" class="flex justify-center items-center mb-6 h-48 md:h-56 bg-gray-50 rounded-xl border border-dashed border-gray-300 hidden">
                        <!-- SVG injected here -->
                    </div>

                    <h2 id="question-text" class="text-xl md:text-2xl font-bold text-gray-800 mb-8 leading-relaxed text-center">
                        Nh·∫•n n√∫t b·∫Øt ƒë·∫ßu ƒë·ªÉ l√†m b√†i!
                    </h2>

                    <div id="options-grid" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- Options injected here -->
                    </div>

                    <!-- Khu v·ª±c hi·ªÉn th·ªã gi·∫£i th√≠ch inline -->
                    <div id="explanation-area" class="hidden mt-6 p-4 bg-yellow-50 border-l-4 border-yellow-400 rounded-r-lg text-gray-700 text-sm md:text-base fade-in">
                        <!-- N·ªôi dung gi·∫£i th√≠ch s·∫Ω ƒë∆∞·ª£c JS th√™m v√†o ƒë√¢y -->
                    </div>
                </div>
            </div>

            <!-- Footer / Controls -->
            <div class="bg-gray-50 p-4 border-t border-gray-100 flex items-center justify-between">
                <div id="feedback-inline" class="text-lg font-bold hidden pl-2"></div>
                <button id="btn-next" onclick="handleNextClick()" class="ml-auto bg-white border border-gray-300 text-gray-600 px-6 py-2 rounded-full font-bold hover:bg-gray-100 transition flex items-center shadow-sm">
                    B·ªè qua <i class="fas fa-forward ml-2"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Footer Info -->
    <footer class="mt-8 text-center text-gray-500 text-xs">
        <p>¬© Th·∫ßy Nguy·ªÖn Vi·ªát Ho√†ng - Tr∆∞·ªùng THCS Nguy·ªÖn An Kh∆∞∆°ng - daytoanthayhoang.github.io</p>
    </footer>

    <!-- Feedback Modal (Overlay) -->
    <div id="feedback-overlay" class="fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center p-4 fade-in">
        <div class="bg-white rounded-2xl shadow-2xl max-w-lg w-full p-6 text-center relative">
            <div id="feedback-icon" class="text-6xl mb-4"></div>
            <h3 id="feedback-title" class="text-2xl font-bold mb-2"></h3>
            <p id="feedback-message" class="text-gray-700 mb-4 text-lg font-medium"></p>
            <div class="bg-blue-50 p-4 rounded-xl text-left mb-6">
                <p class="text-xs text-blue-500 font-bold uppercase mb-1">Gi·∫£i th√≠ch:</p>
                <p id="feedback-detail" class="text-gray-800 text-sm leading-relaxed"></p>
            </div>
            <button onclick="closeModal()" class="w-full py-3 bg-pink-600 text-white font-bold rounded-xl shadow-lg hover:bg-pink-700 transition transform hover:-translate-y-1">
                ƒê√≥ng ƒë·ªÉ xem l·∫°i <i class="fas fa-times ml-2"></i>
            </button>
        </div>
    </div>

    <script>
        // --- DATA & GENERATORS ---

        // Helper: Sinh s·ªë ng·∫´u nhi√™n
        function randomInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        // Helper: Tr·ªôn m·∫£ng
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Helper: V·∫Ω SVG
        const renderShapeSVG = (type) => {
            const size = 160;
            const center = size / 2;
            let svgContent = '';
            
            switch(type) {
                case 'tamgiacdeu':
                    // Tam gi√°c ƒë·ªÅu: 3 ƒë·ªânh
                    svgContent = `<polygon points="${center},10 ${size-20},${size-20} 20,${size-20}" class="shape-svg" />`;
                    break;
                case 'hinhvuong':
                    svgContent = `<rect x="30" y="30" width="100" height="100" class="shape-svg" />`;
                    break;
                case 'lucgiacdeu':
                    // L·ª•c gi√°c ƒë·ªÅu
                    const r = 60;
                    let points = [];
                    for(let i=0; i<6; i++) {
                        let angle_deg = 60 * i - 30;
                        let angle_rad = Math.PI / 180 * angle_deg;
                        let x = center + r * Math.cos(angle_rad);
                        let y = center + r * Math.sin(angle_rad);
                        points.push(`${x},${y}`);
                    }
                    svgContent = `<polygon points="${points.join(' ')}" class="shape-svg" />`;
                    break;
                case 'hinhchunhat':
                    svgContent = `<rect x="20" y="50" width="120" height="60" class="shape-svg" />`;
                    break;
                case 'hinhthoi':
                    svgContent = `<polygon points="${center},10 ${size-30},${center} ${center},${size-10} 30,${center}" class="shape-svg" />`;
                    break;
                case 'hinhbinhhanh':
                    svgContent = `<polygon points="40,40 140,40 120,120 20,120" class="shape-svg" />`;
                    break;
                case 'hinhthangcan':
                    svgContent = `<polygon points="50,40 110,40 140,120 20,120" class="shape-svg" />`;
                    break;
                default:
                    svgContent = '';
            }
            return `<svg width="${size}" height="${size}" viewBox="0 0 ${size} ${size}" xmlns="http://www.w3.org/2000/svg" class="shape-container">${svgContent}</svg>`;
        };

        // --- CONTENT GENERATORS ---

        // 1. NH·∫¨N DI·ªÜN H√åNH ·∫¢NH (Visual)
        const generateVisualQuestion = (isCore = true) => {
            let shapes = [];
            if (isCore) {
                shapes = [
                    { id: 'tamgiacdeu', name: 'Tam gi√°c ƒë·ªÅu', correct: 'Tam gi√°c ƒë·ªÅu' },
                    { id: 'hinhvuong', name: 'H√¨nh vu√¥ng', correct: 'H√¨nh vu√¥ng' },
                    { id: 'lucgiacdeu', name: 'L·ª•c gi√°c ƒë·ªÅu', correct: 'L·ª•c gi√°c ƒë·ªÅu' }
                ];
            } else {
                shapes = [
                    { id: 'hinhchunhat', name: 'H√¨nh ch·ªØ nh·∫≠t', correct: 'H√¨nh ch·ªØ nh·∫≠t' },
                    { id: 'hinhthoi', name: 'H√¨nh thoi', correct: 'H√¨nh thoi' },
                    { id: 'hinhbinhhanh', name: 'H√¨nh b√¨nh h√†nh', correct: 'H√¨nh b√¨nh h√†nh' },
                    { id: 'hinhthangcan', name: 'H√¨nh thang c√¢n', correct: 'H√¨nh thang c√¢n' }
                ];
            }

            const target = shapes[randomInt(0, shapes.length - 1)];
            
            // T·∫°o ph∆∞∆°ng √°n nhi·ªÖu
            const allNames = ['Tam gi√°c ƒë·ªÅu', 'H√¨nh vu√¥ng', 'L·ª•c gi√°c ƒë·ªÅu', 'H√¨nh ch·ªØ nh·∫≠t', 'H√¨nh thoi', 'H√¨nh b√¨nh h√†nh', 'H√¨nh thang c√¢n'];
            const distractors = shuffleArray(allNames.filter(n => n !== target.name)).slice(0, 3);
            
            // T·∫°o gi·∫£i th√≠ch k√®m l∆∞u √Ω v·ªÅ t√≠nh ch·ªìng l·∫•p
            let extraNote = "";
            if (target.name === 'H√¨nh vu√¥ng') {
                extraNote = `<br><span class="text-xs text-gray-500 italic mt-1 block"><i class="fas fa-info-circle mr-1"></i>L∆∞u √Ω: H√¨nh vu√¥ng c≈©ng l√† h√¨nh ch·ªØ nh·∫≠t (c√≥ 4 c·∫°nh b·∫±ng nhau) v√† l√† h√¨nh thoi (c√≥ 4 g√≥c vu√¥ng). Tuy nhi√™n, t√™n g·ªçi "H√¨nh vu√¥ng" l√† t√™n g·ªçi ch√≠nh x√°c v√† ƒë·∫ßy ƒë·ªß t√≠nh ch·∫•t nh·∫•t cho h√¨nh n√†y.</span>`;
            } else if (target.name === 'Tam gi√°c ƒë·ªÅu') {
                extraNote = `<br><span class="text-xs text-gray-500 italic mt-1 block"><i class="fas fa-info-circle mr-1"></i>L∆∞u √Ω: Tam gi√°c ƒë·ªÅu c≈©ng l√† tam gi√°c c√¢n (c√¢n t·∫°i c·∫£ 3 ƒë·ªânh), nh∆∞ng t√™n g·ªçi "Tam gi√°c ƒë·ªÅu" c·ª• th·ªÉ h∆°n v√¨ n√≥ ch·ªâ r√µ 3 c·∫°nh b·∫±ng nhau.</span>`;
            } else if (target.name === 'H√¨nh thoi') {
                extraNote = `<br><span class="text-xs text-gray-500 italic mt-1 block"><i class="fas fa-info-circle mr-1"></i>L∆∞u √Ω: H√¨nh thoi c≈©ng l√† h√¨nh b√¨nh h√†nh (c√≥ 4 c·∫°nh b·∫±ng nhau). ƒê√°p √°n "H√¨nh thoi" l√† ch√≠nh x√°c nh·∫•t.</span>`;
            } else if (target.name === 'H√¨nh ch·ªØ nh·∫≠t') {
                 extraNote = `<br><span class="text-xs text-gray-500 italic mt-1 block"><i class="fas fa-info-circle mr-1"></i>L∆∞u √Ω: H√¨nh ch·ªØ nh·∫≠t c≈©ng l√† h√¨nh b√¨nh h√†nh (c√≥ 4 g√≥c vu√¥ng).</span>`;
            }

            return {
                type: 'visual',
                categoryLabel: 'Nh·∫≠n d·∫°ng h√¨nh v·∫Ω',
                svg: renderShapeSVG(target.id),
                question: "H√¨nh v·∫Ω tr√™n l√† h√¨nh g√¨?",
                options: shuffleArray([target.name, ...distractors]),
                correct: target.name,
                explanation: `H√¨nh v·∫Ω tr√™n c√≥ ƒë·∫ßy ƒë·ªß c√°c ƒë·∫∑c ƒëi·ªÉm nh·∫≠n d·∫°ng ƒë·∫∑c tr∆∞ng nh·∫•t c·ªßa <b>${target.name}</b>.${extraNote}`
            };
        };

        // 2. ƒê·∫∂C ƒêI·ªÇM H√åNH H·ªåC (Text Properties)
        const generatePropertyQuestion = (isCore = true) => {
            const dataCore = [
                {
                    q: "H√¨nh c√≥ 3 c·∫°nh b·∫±ng nhau v√† 3 g√≥c b·∫±ng nhau l√†:",
                    a: "Tam gi√°c ƒë·ªÅu",
                    expl: "Tam gi√°c ƒë·ªÅu l√† tam gi√°c c√≥ 3 c·∫°nh b·∫±ng nhau v√† 3 g√≥c b·∫±ng nhau (ƒë·ªÅu b·∫±ng 60 ƒë·ªô). <br><span class='text-xs italic text-gray-500'>* Tam gi√°c ƒë·ªÅu c≈©ng l√† tam gi√°c c√¢n, nh∆∞ng tam gi√°c c√¢n th√¥ng th∆∞·ªùng ch·ªâ c√≥ 2 c·∫°nh b·∫±ng nhau.</span>"
                },
                {
                    q: "H√¨nh vu√¥ng c√≥ ƒë·∫∑c ƒëi·ªÉm n√†o sau ƒë√¢y?",
                    a: "4 c·∫°nh b·∫±ng nhau v√† 4 g√≥c vu√¥ng",
                    d: ["4 c·∫°nh b·∫±ng nhau v√† 2 g√≥c nh·ªçn", "C√°c c·∫∑p c·∫°nh ƒë·ªëi song song nh∆∞ng kh√¥ng b·∫±ng nhau", "Ch·ªâ c√≥ 2 g√≥c vu√¥ng"],
                    expl: "H√¨nh vu√¥ng l√† t·ª© gi√°c c√≥ 4 g√≥c vu√¥ng v√† 4 c·∫°nh b·∫±ng nhau. <br><span class='text-xs italic text-gray-500'>* H√¨nh vu√¥ng mang ƒë·∫ßy ƒë·ªß t√≠nh ch·∫•t c·ªßa h√¨nh ch·ªØ nh·∫≠t v√† h√¨nh thoi.</span>"
                },
                {
                    q: "L·ª•c gi√°c ƒë·ªÅu ABCDEF ƒë∆∞·ª£c gh√©p b·ªüi bao nhi√™u tam gi√°c ƒë·ªÅu?",
                    a: "6 tam gi√°c ƒë·ªÅu",
                    d: ["4 tam gi√°c ƒë·ªÅu", "5 tam gi√°c ƒë·ªÅu", "3 tam gi√°c ƒë·ªÅu"],
                    expl: "L·ª•c gi√°c ƒë·ªÅu c√≥ th·ªÉ chia th√†nh 6 tam gi√°c ƒë·ªÅu b·∫±ng nhau c√≥ chung ƒë·ªânh l√† t√¢m c·ªßa l·ª•c gi√°c."
                },
                {
                    q: "Trong h√¨nh l·ª•c gi√°c ƒë·ªÅu, c√°c ƒë∆∞·ªùng ch√©o ch√≠nh c√≥ ƒë·∫∑c ƒëi·ªÉm g√¨?",
                    a: "B·∫±ng nhau v√† c·∫Øt nhau t·∫°i trung ƒëi·ªÉm m·ªói ƒë∆∞·ªùng",
                    d: ["Vu√¥ng g√≥c v·ªõi nhau", "Kh√¥ng b·∫±ng nhau", "Song song v·ªõi nhau"],
                    expl: "Trong l·ª•c gi√°c ƒë·ªÅu, 3 ƒë∆∞·ªùng ch√©o ch√≠nh b·∫±ng nhau v√† c·∫Øt nhau t·∫°i t√¢m c·ªßa h√¨nh."
                },
                {
                    q: "H√¨nh vu√¥ng c√≥ bao nhi√™u tr·ª•c ƒë·ªëi x·ª©ng?",
                    a: "4 tr·ª•c",
                    d: ["2 tr·ª•c", "3 tr·ª•c", "1 tr·ª•c"],
                    expl: "H√¨nh vu√¥ng c√≥ 4 tr·ª•c ƒë·ªëi x·ª©ng (2 ƒë∆∞·ªùng ch√©o v√† 2 ƒë∆∞·ªùng th·∫≥ng ƒëi qua trung ƒëi·ªÉm c√°c c·∫°nh ƒë·ªëi di·ªán)."
                }
            ];

            const dataExpanded = [
                {
                    q: "H√¨nh thoi c√≥ hai ƒë∆∞·ªùng ch√©o nh∆∞ th·∫ø n√†o?",
                    a: "Vu√¥ng g√≥c v·ªõi nhau",
                    d: ["B·∫±ng nhau", "Song song", "Kh√¥ng c·∫Øt nhau"],
                    expl: "M·ªôt trong nh·ªØng t√≠nh ch·∫•t ƒë·∫∑c tr∆∞ng c·ªßa h√¨nh thoi l√† hai ƒë∆∞·ªùng ch√©o vu√¥ng g√≥c v·ªõi nhau. <br><span class='text-xs italic text-gray-500'>* ƒê√¢y l√† ƒëi·ªÉm kh√°c bi·ªát so v·ªõi h√¨nh b√¨nh h√†nh th√¥ng th∆∞·ªùng.</span>"
                },
                {
                    q: "H√¨nh ch·ªØ nh·∫≠t c√≥ ƒë·∫∑c ƒëi·ªÉm n√†o sau ƒë√¢y KH√ÅC v·ªõi h√¨nh vu√¥ng?",
                    a: "4 c·∫°nh kh√¥ng nh·∫•t thi·∫øt b·∫±ng nhau (ch·ªâ c√≥ c√°c c·∫°nh ƒë·ªëi b·∫±ng nhau)",
                    d: ["C√≥ 4 g√≥c vu√¥ng", "Hai ƒë∆∞·ªùng ch√©o b·∫±ng nhau", "C√°c c·∫°nh ƒë·ªëi song song"],
                    expl: "C·∫£ h√¨nh vu√¥ng v√† h√¨nh ch·ªØ nh·∫≠t ƒë·ªÅu c√≥ 4 g√≥c vu√¥ng, nh∆∞ng h√¨nh vu√¥ng y√™u c·∫ßu 4 c·∫°nh ph·∫£i b·∫±ng nhau. <br><span class='text-xs italic text-gray-500'>* C√≥ th·ªÉ n√≥i h√¨nh vu√¥ng l√† tr∆∞·ªùng h·ª£p ƒë·∫∑c bi·ªát c·ªßa h√¨nh ch·ªØ nh·∫≠t.</span>"
                },
                {
                    q: "H√¨nh thang c√¢n l√† h√¨nh thang c√≥:",
                    a: "Hai g√≥c k·ªÅ m·ªôt ƒë√°y b·∫±ng nhau",
                    d: ["Hai c·∫°nh b√™n song song", "Hai ƒë√°y b·∫±ng nhau", "Hai ƒë∆∞·ªùng ch√©o vu√¥ng g√≥c"],
                    expl: "H√¨nh thang c√¢n l√† h√¨nh thang c√≥ hai g√≥c k·ªÅ m·ªôt ƒë√°y b·∫±ng nhau (ho·∫∑c hai ƒë∆∞·ªùng ch√©o b·∫±ng nhau)."
                },
                {
                    q: "T·ª© gi√°c c√≥ c√°c c·∫°nh ƒë·ªëi song song l√† h√¨nh g√¨?",
                    a: "H√¨nh b√¨nh h√†nh",
                    d: ["H√¨nh thang c√¢n", "H√¨nh tam gi√°c", "H√¨nh thang vu√¥ng"],
                    expl: "H√¨nh b√¨nh h√†nh l√† t·ª© gi√°c c√≥ c√°c c·∫∑p c·∫°nh ƒë·ªëi song song. <br><span class='text-xs italic text-gray-500'>* H√¨nh vu√¥ng, h√¨nh ch·ªØ nh·∫≠t, h√¨nh thoi ƒë·ªÅu l√† c√°c d·∫°ng ƒë·∫∑c bi·ªát c·ªßa h√¨nh b√¨nh h√†nh.</span>"
                }
            ];

            const pool = isCore ? dataCore : dataExpanded;
            const item = pool[randomInt(0, pool.length - 1)];

            // N·∫øu ch∆∞a c√≥ distractors (d), t·ª± sinh
            let options = [];
            if (item.d) {
                options = shuffleArray([item.a, ...item.d]);
            } else {
                const shapes = ["Tam gi√°c ƒë·ªÅu", "H√¨nh vu√¥ng", "L·ª•c gi√°c ƒë·ªÅu", "H√¨nh ch·ªØ nh·∫≠t", "H√¨nh thoi"];
                const dists = shuffleArray(shapes.filter(s => s !== item.a)).slice(0, 3);
                options = shuffleArray([item.a, ...dists]);
            }

            return {
                type: 'property',
                categoryLabel: 'T√≠nh ch·∫•t h√¨nh h·ªçc',
                svg: null,
                question: item.q,
                options: options,
                correct: item.a,
                explanation: item.expl
            };
        };

        // 3. LI√äN H·ªÜ TH·ª∞C T·∫æ (Real World)
        const generateRealWorldQuestion = () => {
            const data = [
                {
                    q: "Bi·ªÉn b√°o giao th√¥ng 'C·∫£nh b√°o nguy hi·ªÉm' (vi·ªÅn ƒë·ªè, n·ªÅn v√†ng) th∆∞·ªùng c√≥ d·∫°ng h√¨nh g√¨?",
                    a: "H√¨nh tam gi√°c ƒë·ªÅu",
                    expl: "C√°c bi·ªÉn b√°o nguy hi·ªÉm th∆∞·ªùng c√≥ d·∫°ng h√¨nh tam gi√°c ƒë·ªÅu."
                },
                {
                    q: "Vi√™n g·∫°ch l√°t n·ªÅn h√¨nh t·ªï ong th∆∞·ªùng c√≥ d·∫°ng h√¨nh g√¨?",
                    a: "H√¨nh l·ª•c gi√°c ƒë·ªÅu",
                    expl: "C·∫•u tr√∫c t·ªï ong v√† c√°c lo·∫°i g·∫°ch l√°t n·ªÅn t·ªï ong l√† h√¨nh l·ª•c gi√°c ƒë·ªÅu, gi√∫p gh√©p kh√≠t nhau kh√¥ng t·∫°o khe h·ªü."
                },
                {
                    q: "M·∫∑t c·ªßa kh·ªëi Rubik (3x3) c√≥ d·∫°ng h√¨nh g√¨?",
                    a: "H√¨nh vu√¥ng",
                    expl: "M·ªói m·∫∑t c·ªßa kh·ªëi l·∫≠p ph∆∞∆°ng Rubik l√† m·ªôt h√¨nh vu√¥ng."
                },
                {
                    q: "Khung c·ª≠a s·ªï th√¥ng th∆∞·ªùng c√≥ d·∫°ng h√¨nh g√¨?",
                    a: "H√¨nh ch·ªØ nh·∫≠t",
                    expl: "ƒêa s·ªë khung c·ª≠a s·ªï, c·ª≠a ra v√†o c√≥ d·∫°ng h√¨nh ch·ªØ nh·∫≠t (c√°c g√≥c vu√¥ng v√† c·∫°nh ƒë·ªëi b·∫±ng nhau)."
                },
                {
                    q: "C√°nh di·ªÅu truy·ªÅn th·ªëng th∆∞·ªùng g·ª£i li√™n t∆∞·ªüng ƒë·∫øn h√¨nh g√¨?",
                    a: "H√¨nh thoi",
                    expl: "H√¨nh d·∫°ng t·ª© gi√°c c√≥ 4 c·∫°nh b·∫±ng nhau th∆∞·ªùng g·∫∑p ·ªü c√°nh di·ªÅu l√† h√¨nh thoi."
                },
                {
                    q: "M√†n h√¨nh TV, m√°y t√≠nh th∆∞·ªùng c√≥ d·∫°ng h√¨nh g√¨?",
                    a: "H√¨nh ch·ªØ nh·∫≠t",
                    expl: "M√†n h√¨nh c√°c thi·∫øt b·ªã ƒëi·ªán t·ª≠ th∆∞·ªùng c√≥ d·∫°ng h√¨nh ch·ªØ nh·∫≠t."
                },
                {
                    q: "B√°nh ch∆∞ng truy·ªÅn th·ªëng ng√†y T·∫øt c√≥ d·∫°ng h√¨nh g√¨ (nh√¨n t·ª´ m·∫∑t tr√™n)?",
                    a: "H√¨nh vu√¥ng",
                    expl: "B√°nh ch∆∞ng ƒë∆∞·ª£c g√≥i theo khu√¥n h√¨nh vu√¥ng, t∆∞·ª£ng tr∆∞ng cho ƒê·∫•t."
                }
            ];

            const item = data[randomInt(0, data.length - 1)];
            const shapes = ["H√¨nh tam gi√°c ƒë·ªÅu", "H√¨nh vu√¥ng", "H√¨nh l·ª•c gi√°c ƒë·ªÅu", "H√¨nh ch·ªØ nh·∫≠t", "H√¨nh tr√≤n"];
            const dists = shuffleArray(shapes.filter(s => s !== item.a)).slice(0, 3);

            return {
                type: 'realworld',
                categoryLabel: 'Li√™n h·ªá th·ª±c t·∫ø',
                svg: null,
                question: item.q,
                options: shuffleArray([item.a, ...dists]),
                correct: item.a,
                explanation: item.expl
            };
        };

        // --- APP STATE ---
        const state = {
            currentCategory: 'all', // all, visual, realworld, property
            streak: 0,
            correct: 0,
            wrong: 0,
            skipped: 0,
            currentQuestion: null,
            isAnswered: false
        };

        function initCategoryButtons() {
            const categories = [
                { id: 'all', label: 'T·ªïng h·ª£p', icon: 'fa-random', color: 'bg-indigo-600' },
                { id: 'visual', label: 'Qua h√¨nh v·∫Ω', icon: 'fa-eye', color: 'bg-green-600' },
                { id: 'realworld', label: 'Th·ª±c t·∫ø', icon: 'fa-globe-asia', color: 'bg-blue-600' },
                { id: 'property', label: 'T√≠nh ch·∫•t', icon: 'fa-list-ul', color: 'bg-pink-600' }
            ];

            const container = document.getElementById('category-buttons');
            container.innerHTML = categories.map(cat => `
                <button onclick="changeCategory('${cat.id}')" 
                    class="category-btn ${cat.id === 'all' ? 'ring-2 ring-offset-2 ring-pink-400' : ''} 
                           flex items-center gap-2 px-3 py-2 rounded-lg text-white text-sm font-bold shadow-md 
                           ${cat.color} hover:opacity-90 transition-all">
                    <i class="fas ${cat.icon}"></i> ${cat.label}
                </button>
            `).join('');
        }

        function changeCategory(id) {
            state.currentCategory = id;
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('ring-2', 'ring-offset-2', 'ring-pink-400');
            });
            event.currentTarget.classList.add('ring-2', 'ring-offset-2', 'ring-pink-400');
            generateNewQuestion(true);
        }

        function getQuestionData() {
            // X√°c ƒë·ªãnh lo·∫°i c√¢u h·ªèi d·ª±a tr√™n Category (Ch·∫ø ƒë·ªô)
            let mode = state.currentCategory;
            
            // N·∫øu l√† 'all', random ra 1 trong 3 ch·∫ø ƒë·ªô
            if (mode === 'all') {
                const modes = ['visual', 'realworld', 'property'];
                mode = modes[randomInt(0, modes.length - 1)];
            }

            let qData;
            
            if (mode === 'visual') {
                // Gi·ªØ t·ªâ l·ªá 70% Core (Tam gi√°c ƒë·ªÅu, Vu√¥ng, L·ª•c gi√°c ƒë·ªÅu) - 30% Expanded
                const isCore = Math.random() < 0.7;
                qData = generateVisualQuestion(isCore);
            } 
            else if (mode === 'realworld') {
                // Th·ª±c t·∫ø
                qData = generateRealWorldQuestion();
            } 
            else if (mode === 'property') {
                // Gi·ªØ t·ªâ l·ªá 70% Core - 30% Expanded
                const isCore = Math.random() < 0.7;
                qData = generatePropertyQuestion(isCore);
            }
            
            return qData;
        }

        function generateNewQuestion(skipStats = false) {
            state.isAnswered = false;
            
            // UI Reset
            document.getElementById('feedback-inline').className = "hidden";
            const btnNext = document.getElementById('btn-next');
            btnNext.innerHTML = 'B·ªè qua <i class="fas fa-forward ml-2"></i>';
            btnNext.className = "ml-auto bg-white border border-gray-300 text-gray-600 px-6 py-2 rounded-full font-bold hover:bg-gray-100 transition flex items-center shadow-sm";
            
            document.getElementById('explanation-area').classList.add('hidden');
            document.getElementById('explanation-area').innerHTML = '';
            
            const visualArea = document.getElementById('visual-area');
            
            // Get Data
            const q = getQuestionData();
            state.currentQuestion = q; 

            // Find correct index
            const correctIndex = q.options.indexOf(q.correct);
            state.currentQuestion.correctIndex = correctIndex;

            // Render Badge & Question
            document.getElementById('badge-topic').innerText = q.categoryLabel || 'T·ªïng h·ª£p';
            document.getElementById('question-text').innerHTML = q.question;
            
            // Show SVG if exists
            if (q.svg) {
                visualArea.classList.remove('hidden');
                visualArea.innerHTML = q.svg;
            } else {
                visualArea.classList.add('hidden');
            }

            // Options
            const optionsHtml = q.options.map((opt, index) => `
                <button onclick="checkAnswer(this, ${index})" 
                    class="option-card w-full text-left p-4 rounded-xl border-2 border-gray-100 bg-pink-50 hover:border-pink-300 hover:bg-pink-100 text-gray-700 font-semibold relative overflow-hidden group">
                    <span class="inline-block w-8 h-8 rounded-full bg-white text-center leading-8 mr-3 text-pink-600 font-bold shadow-sm group-hover:bg-pink-600 group-hover:text-white transition">
                        ${String.fromCharCode(65 + index)}
                    </span>
                    ${opt}
                </button>
            `).join('');
            document.getElementById('options-grid').innerHTML = optionsHtml;
        }

        function checkAnswer(btn, selectedIndex) {
            if (state.isAnswered) return;
            state.isAnswered = true;

            const isCorrect = selectedIndex === state.currentQuestion.correctIndex;
            const inlineFeedback = document.getElementById('feedback-inline');
            const overlay = document.getElementById('feedback-overlay');
            const icon = document.getElementById('feedback-icon');
            const title = document.getElementById('feedback-title');
            const msg = document.getElementById('feedback-message');
            const detail = document.getElementById('feedback-detail');

            // Disable buttons
            const allBtns = document.querySelectorAll('.option-card');
            allBtns.forEach(b => {
                b.disabled = true;
                b.classList.add('opacity-75');
            });

            // Highlight Correct
            const correctBtn = allBtns[state.currentQuestion.correctIndex];
            correctBtn.classList.remove('bg-pink-50', 'border-gray-100', 'hover:border-pink-300', 'hover:bg-pink-100', 'opacity-75');
            correctBtn.classList.add('bg-green-100', 'border-green-500', 'text-green-800', 'opacity-100', 'border-2');
            const correctSpan = correctBtn.querySelector('span');
            correctSpan.classList.remove('text-pink-600', 'bg-white');
            correctSpan.classList.add('bg-green-600', 'text-white');

            if (isCorrect) {
                state.streak++;
                state.correct++;
                
                btn.classList.add('bg-green-500', 'text-white');
                btn.querySelector('span').classList.remove('bg-green-600', 'text-white');
                btn.querySelector('span').classList.add('bg-white', 'text-green-600');
                btn.classList.add('pop');

                inlineFeedback.innerHTML = '<span class="text-green-600"><i class="fas fa-check-circle"></i> Ch√≠nh x√°c!</span>';
                inlineFeedback.className = "text-lg font-bold block pl-2 animate-bounce";
            } else {
                state.streak = 0;
                state.wrong++;

                btn.classList.remove('bg-pink-50', 'border-gray-100');
                btn.classList.add('bg-red-500', 'border-red-600', 'text-white', 'shake', 'opacity-100');
                btn.querySelector('span').classList.remove('text-pink-600', 'bg-white');
                btn.querySelector('span').classList.add('text-red-600', 'bg-white');

                inlineFeedback.innerHTML = '<span class="text-red-500"><i class="fas fa-times-circle"></i> Ch∆∞a ƒë√∫ng!</span>';
                inlineFeedback.className = "text-lg font-bold block pl-2";

                // Setup Modal
                icon.innerHTML = '<i class="fas fa-times-circle text-red-500"></i>';
                title.innerText = "Ch∆∞a ch√≠nh x√°c";
                title.className = "text-2xl font-bold mb-2 text-red-600";
                msg.innerText = `ƒê√°p √°n ƒë√∫ng l√†: ${state.currentQuestion.correct}`;
                
                // Show modal
                setTimeout(() => { overlay.classList.remove('hidden'); }, 400);
            }

            // Show explanation
            const explArea = document.getElementById('explanation-area');
            explArea.innerHTML = `<p class="font-bold text-pink-800 mb-1"><i class="fas fa-lightbulb text-yellow-500 mr-2"></i>Gi·∫£i th√≠ch:</p> ${state.currentQuestion.explanation}`;
            explArea.classList.remove('hidden');

            // Modal detail
            detail.innerHTML = state.currentQuestion.explanation;

            renderStats();

            // Update Next Btn
            const btnNext = document.getElementById('btn-next');
            btnNext.innerHTML = 'Ti·∫øp theo <i class="fas fa-arrow-right ml-2"></i>';
            btnNext.className = "ml-auto bg-pink-600 text-white px-6 py-2 rounded-full font-bold hover:bg-pink-700 transition flex items-center shadow-lg transform scale-105";
        }

        function renderStats() {
            const container = document.getElementById('stats-container');
            container.innerHTML = `
                <div class="flex flex-col items-center">
                    <span class="text-xs text-gray-500 uppercase font-bold">Chu·ªói th·∫Øng üî•</span>
                    <span class="text-3xl font-extrabold ${state.streak > 2 ? 'streak-fire' : 'text-pink-900'}">
                        ${state.streak > 2 ? '<i class="fas fa-fire"></i> ' : ''}${state.streak}
                    </span>
                </div>
                <div class="flex flex-col items-center border-l border-gray-200">
                    <span class="text-xs text-gray-500 uppercase font-bold">ƒê√∫ng</span>
                    <span class="text-xl font-bold text-green-600">${state.correct}</span>
                </div>
                <div class="flex flex-col items-center border-l border-gray-200">
                    <span class="text-xs text-gray-500 uppercase font-bold">Sai</span>
                    <span class="text-xl font-bold text-red-500">${state.wrong}</span>
                </div>
                <div class="flex flex-col items-center border-l border-gray-200">
                    <span class="text-xs text-gray-500 uppercase font-bold">B·ªè qua</span>
                    <span class="text-xl font-bold text-gray-400">${state.skipped}</span>
                </div>
            `;
        }

        function handleNextClick() {
            if (!state.isAnswered) {
                state.streak = 0;
                state.skipped++;
                renderStats();
            }
            generateNewQuestion();
        }

        function closeModal() {
            document.getElementById('feedback-overlay').classList.add('hidden');
        }

        // Init
        initCategoryButtons();
        renderStats();
        generateNewQuestion();

    </script>
</body>
</html>