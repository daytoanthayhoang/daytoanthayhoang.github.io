<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chinh Ph·ª•c ƒê·∫°i L∆∞·ª£ng T·ªâ L·ªá Thu·∫≠n</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;800&display=swap');
        body {
            font-family: 'Nunito', sans-serif;
            background-color: #f0f9ff;
        }
        .chalkboard {
            background-color: #263238; /* Dark Slate */
            color: #eceff1;
            border: 8px solid #795548; /* Brown border like wood */
            border-radius: 10px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
            position: relative;
        }
        .chalkboard::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1MCIgaGVpZ2h0PSI1MCI+CjxyZWN0IHdpZHRoPSI1MCIgaGVpZ2h0PSI1MCIgZmlsbD0ibm9uZSIvPgo8cGF0aCBkPSJNMSAxTDQ5IDQ5TTEgNDlMNDkgMSIgc3Ryb2tlPSJyZ2JhKDI1NSwyNTUsMjU1LDAuMDMpIiBzdHJva2Utd2lkdGg9IjIiLz4KPC9zdmc+');
            opacity: 0.1;
            pointer-events: none;
        }
        .btn-mode {
            transition: all 0.2s;
            border-bottom: 4px solid transparent;
        }
        .btn-mode:active {
            transform: translateY(2px);
            border-bottom-width: 0;
        }
        .mode-active {
            background-color: #059669 !important; /* emerald-600 */
            color: white !important;
            border-bottom: 4px solid #064e3b !important; /* emerald-800 */
            transform: translateY(-2px);
        }
        .step-item {
            opacity: 0;
            transform: translateY(-10px);
            animation: slideDown 0.4s forwards;
        }
        @keyframes slideDown {
            to { opacity: 1; transform: translateY(0); }
        }
        /* Fraction CSS class */
        .frac {
            display: inline-block;
            position: relative;
            vertical-align: middle;
            letter-spacing: 0.001em;
            text-align: center;
        }
        .frac > span {
            display: block;
            padding: 0.1em;
        }
        .frac span.bottom {
            border-top: thin solid white;
        }
        .frac span.symbol {
            display: none;
        }
        /* Dark theme fraction adjustment */
        .text-gray-800 .frac span.bottom {
            border-top: thin solid #1f2937;
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-2 md:p-4">

    <div class="max-w-5xl w-full bg-white rounded-2xl shadow-2xl overflow-hidden border-4 border-emerald-200">
        <!-- Header -->
        <div class="bg-emerald-600 p-4 md:p-6 text-center relative">
            <h1 class="text-2xl md:text-3xl font-extrabold text-white uppercase tracking-wider">
                <i class="fas fa-balance-scale mr-2"></i>ƒê·∫†I L∆Ø·ª¢NG T·ªà L·ªÜ THU·∫¨N
            </h1>
            <p class="text-emerald-100 mt-1 text-sm md:text-base">M√¥ ph·ªèng l·ªùi gi·∫£i & Luy·ªán t·∫≠p - daytoanthayhoang.github.io</p>
            <div class="absolute top-4 right-4 bg-white/20 px-3 py-1 rounded-full text-white font-bold text-sm">
                ƒêi·ªÉm: <span id="score">0</span>
            </div>
        </div>

        <div class="p-4 md:p-6 space-y-6">
            
            <!-- Mode Selection Buttons -->
            <div class="bg-gray-50 p-4 rounded-xl border border-gray-200">
                <label class="block text-gray-700 font-bold mb-3 text-sm uppercase tracking-wide"><i class="fas fa-layer-group mr-2"></i>Ch·ªçn d·∫°ng b√†i:</label>
                
                <div class="grid grid-cols-2 md:grid-cols-4 gap-2 mb-3">
                    <button onclick="setMode('find_k')" id="btn-find_k" class="btn-mode bg-white border border-gray-300 text-gray-700 py-3 rounded-lg font-bold text-sm hover:bg-emerald-50 shadow-sm">
                        1. T√¨m h·ªá s·ªë (k)
                    </button>
                    <button onclick="setMode('find_val')" id="btn-find_val" class="btn-mode bg-white border border-gray-300 text-gray-700 py-3 rounded-lg font-bold text-sm hover:bg-emerald-50 shadow-sm">
                        2. T√¨m gi√° tr·ªã (y)
                    </button>
                    <button onclick="setMode('word_simple')" id="btn-word_simple" class="btn-mode bg-white border border-gray-300 text-gray-700 py-3 rounded-lg font-bold text-sm hover:bg-emerald-50 shadow-sm">
                        3. B√†i to√°n ƒë·ªë (ƒê∆°n gi·∫£n)
                    </button>
                    <button onclick="setMode('word_hard')" id="btn-word_hard" class="btn-mode bg-white border border-gray-300 text-gray-700 py-3 rounded-lg font-bold text-sm hover:bg-emerald-50 shadow-sm">
                        4. B√†i to√°n ƒë·ªë (N√¢ng cao)
                    </button>
                </div>
            </div>

            <!-- Question Area -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Left: Question Board -->
                <div class="flex flex-col">
                    <div class="chalkboard p-6 md:p-8 text-center relative flex-grow flex flex-col justify-center items-center min-h-[300px]">
                        <div class="absolute top-2 left-3 text-gray-400 text-xs font-mono">ƒê·ªÅ b√†i:</div>
                        
                        <!-- Question Content -->
                        <div id="question-text" class="text-xl md:text-2xl font-bold tracking-wide mb-6 font-mono leading-relaxed text-yellow-100">
                            Loading...
                        </div>
                        
                        <!-- Formula Hint Overlay (Optional) -->
                        <div id="formula-display" class="mt-4 p-2 border border-dashed border-gray-500 rounded text-sm text-gray-300 hidden">
                            <i class="fas fa-lightbulb text-yellow-500 mr-1"></i> G·ª£i √Ω: <span class="font-mono">y = k.x</span>
                        </div>
                    </div>
                </div>

                <!-- Right: Step-by-step & Hint Area -->
                <div class="bg-white rounded-xl border-2 border-dashed border-emerald-300 p-4 flex flex-col shadow-inner h-[400px]">
                    <div class="flex justify-between items-center mb-3 pb-2 border-b border-gray-100">
                        <h3 class="font-bold text-gray-700 text-sm md:text-base"><i class="fas fa-shoe-prints mr-2 text-emerald-500"></i>C√°c b∆∞·ªõc gi·∫£i:</h3>
                        <button onclick="showNextStep()" id="btn-show-step" class="bg-emerald-500 hover:bg-emerald-600 text-white text-xs md:text-sm font-bold py-1.5 px-3 rounded-lg shadow transition-colors flex items-center">
                            <i class="fas fa-eye mr-2"></i> G·ª£i √Ω b∆∞·ªõc sau
                        </button>
                    </div>
                    
                    <!-- Steps Container -->
                    <div id="steps-container" class="flex-grow space-y-3 overflow-y-auto pr-2 text-gray-800 font-mono text-sm md:text-base">
                        <div class="text-gray-400 italic text-sm text-center mt-10">
                            B·∫•m "G·ª£i √Ω b∆∞·ªõc sau" ƒë·ªÉ xem t·ª´ng b∆∞·ªõc gi·∫£i chi ti·∫øt...
                        </div>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="flex flex-col md:flex-row gap-4 justify-center items-center mt-4 bg-emerald-50 p-4 rounded-xl border border-emerald-100">
                <div class="w-full md:w-1/3">
                     <label class="block text-xs font-bold text-emerald-800 uppercase mb-1 ml-1">Nh·∫≠p ƒë√°p √°n c·ªßa b·∫°n:</label>
                     <input type="number" step="0.01" id="user-answer" placeholder="K·∫øt qu·∫£..." 
                        class="w-full text-center text-2xl font-bold p-3 border-2 border-gray-300 rounded-xl focus:border-emerald-500 focus:outline-none transition-colors shadow-inner text-emerald-800"
                        onkeydown="if(event.key === 'Enter') checkAnswer()">
                </div>
                
                <div class="flex gap-2 w-full md:w-auto">
                    <button onclick="checkAnswer()" class="flex-1 md:flex-none bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-3 px-8 rounded-xl text-lg transition-all shadow-lg transform hover:-translate-y-1">
                        <i class="fas fa-check-circle mr-2"></i>Ki·ªÉm tra
                    </button>
                    
                    <button onclick="nextQuestion()" class="flex-1 md:flex-none bg-white hover:bg-gray-50 text-gray-600 border border-gray-300 font-bold py-3 px-6 rounded-xl text-lg transition-colors">
                        <i class="fas fa-forward mr-2"></i>B·ªè qua
                    </button>
                </div>
            </div>

            <!-- Result Feedback -->
            <div id="feedback" class="hidden text-center fade-in mt-2 p-4 rounded-xl"></div>

        </div>
    </div>

    <script>
        // --- State Management ---
        let currentQuestion = {};
        let score = 0;
        let isAnswered = false;
        let currentMode = 'find_k';
        let stepIndex = 0;

        // --- Utilities ---
        function getRandomInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        // T·∫°o ph√¢n s·ªë HTML
        function toFracHTML(num, den) {
            if (den === 1) return num;
            return `<div class="frac"><span>${num}</span><span class="symbol">/</span><span class="bottom">${den}</span></div>`;
        }

        // ƒê·ªãnh d·∫°ng s·ªë (n·∫øu s·ªë nguy√™n th√¨ hi·ªÉn th·ªã nguy√™n, n·∫øu th·∫≠p ph√¢n th√¨ hi·ªÉn th·ªã g·ªçn)
        function fmt(num) {
            return Number.isInteger(num) ? num : parseFloat(num.toFixed(2));
        }

        // --- Generators ---

        // D·∫°ng 1: T√¨m h·ªá s·ªë k (y = kx)
        function genFindK() {
            const k = getRandomInt(2, 9) * (Math.random() > 0.5 ? 1 : -1);
            const x = getRandomInt(2, 10);
            const y = k * x;

            return {
                type: 'basic',
                display: `Cho bi·∫øt <span class="text-yellow-300">y</span> t·ªâ l·ªá thu·∫≠n v·ªõi <span class="text-yellow-300">x</span>.<br> Khi <span class="text-green-300">x = ${x}</span> th√¨ <span class="text-green-300">y = ${y}</span>.<br><br>T√¨m h·ªá s·ªë t·ªâ l·ªá <span class="text-pink-300">k</span>?`,
                answer: k,
                steps: [
                    `C√¥ng th·ª©c t·ªïng qu√°t: <b>y = k . x</b>`,
                    `Suy ra c√¥ng th·ª©c t√¨m k: <b>k = ${toFracHTML('y','x')}</b>`,
                    `Thay s·ªë: k = ${toFracHTML(y, x)}`,
                    `T√≠nh to√°n: k = ${k}`
                ],
                hint: "Nh·ªõ c√¥ng th·ª©c: y = k.x"
            };
        }

        // D·∫°ng 2: T√¨m y khi bi·∫øt k v√† x
        function genFindVal() {
            const k = getRandomInt(2, 8) * (Math.random() > 0.5 ? 1 : -1);
            const x_given = getRandomInt(3, 12);
            // Ch·ªçn m·ªôt c·∫∑p ban ƒë·∫ßu ƒë·ªÉ h·ªçc sinh t·ª± t√¨m k tr∆∞·ªõc (n√¢ng cao h∆°n ch√∫t)
            // Ho·∫∑c cho th·∫≥ng k. ƒê·ªÉ m√¥ ph·ªèng "b√†i to√°n m·∫´u", ta cho y t·ªâ l·ªá thu·∫≠n v·ªõi x theo h·ªá s·ªë k.
            
            return {
                type: 'basic',
                display: `Cho <span class="text-yellow-300">y</span> t·ªâ l·ªá thu·∫≠n v·ªõi <span class="text-yellow-300">x</span> theo h·ªá s·ªë t·ªâ l·ªá <span class="text-pink-300">k = ${k}</span>.<br><br>T√≠nh gi√° tr·ªã c·ªßa <span class="text-green-300">y</span> khi <span class="text-green-300">x = ${x_given}</span>?`,
                answer: k * x_given,
                steps: [
                    `C√¥ng th·ª©c li√™n h·ªá: <b>y = ${k} . x</b>`,
                    `Thay gi√° tr·ªã x = ${x_given} v√†o c√¥ng th·ª©c.`,
                    `y = ${k} . ${x_given}`,
                    `y = ${k * x_given}`
                ],
                hint: "Thay k v√† x v√†o c√¥ng th·ª©c y = kx"
            };
        }

        // D·∫°ng 3: B√†i to√°n ƒë·ªë (R√∫t v·ªÅ ƒë∆°n v·ªã / Tam su·∫•t ƒë∆°n gi·∫£n)
        function genWordSimple() {
            // Template: Mua A c√°i B h·∫øt C ti·ªÅn. Mua D c√°i B h·∫øt bao nhi√™u?
            const items = ["quy·ªÉn v·ªü", "c√¢y b√∫t", "g√≥i k·∫πo", "m√©t v·∫£i", "kg g·∫°o"];
            const item = items[getRandomInt(0, items.length - 1)];
            
            const unitPrice = getRandomInt(2, 9) * 1000; // Gi√° 2000 - 9000
            const quantity1 = getRandomInt(2, 5);
            const total1 = unitPrice * quantity1;
            
            const quantity2 = getRandomInt(6, 10);
            const total2 = unitPrice * quantity2;

            return {
                type: 'word',
                display: `Mua <b>${quantity1}</b> ${item} h·∫øt <b>${(total1/1000)}k</b> ƒë·ªìng.<br>H·ªèi mua <b>${quantity2}</b> ${item} nh∆∞ th·∫ø h·∫øt bao nhi√™u ti·ªÅn? <br><small class="text-gray-400 text-sm">(Nh·∫≠p k·∫øt qu·∫£ theo ƒë∆°n v·ªã ƒë·ªìng, v√≠ d·ª•: 50000)</small>`,
                answer: total2,
                steps: [
                    `<b>B∆∞·ªõc 1: R√∫t v·ªÅ ƒë∆°n v·ªã (T√¨m gi√° 1 ${item})</b>`,
                    `Gi√° 1 ${item} l√†: ${total1} : ${quantity1} = ${unitPrice} (ƒë·ªìng)`,
                    `<b>B∆∞·ªõc 2: T√≠nh gi√° ti·ªÅn cho ${quantity2} ${item}</b>`,
                    `S·ªë ti·ªÅn ph·∫£i tr·∫£: ${unitPrice} . ${quantity2} = ${total2} (ƒë·ªìng)`
                ],
                hint: "T√≠nh gi√° ti·ªÅn 1 m√≥n tr∆∞·ªõc, sau ƒë√≥ nh√¢n l√™n."
            };
        }

        // D·∫°ng 4: B√†i to√°n ƒë·ªë n√¢ng cao (D√πng t·ªâ l·ªá th·ª©c ho·∫∑c kh·ªëi l∆∞·ª£ng c√¥ng vi·ªác)
        function genWordHard() {
            // Template: M√°y l√†m X s·∫£n ph·∫©m h·∫øt Y ph√∫t. H·ªèi l√†m Z s·∫£n ph·∫©m h·∫øt bao nhi√™u ph√∫t?
            const subjects = [
                { name: "M√°y in", action: "in ƒë∆∞·ª£c", unit1: "trang", unit2: "ph√∫t" },
                { name: "C√¥ng nh√¢n", action: "l√†m ƒë∆∞·ª£c", unit1: "s·∫£n ph·∫©m", unit2: "gi·ªù" },
                { name: "√î t√¥", action: "ƒëi ƒë∆∞·ª£c", unit1: "km", unit2: "l√≠t xƒÉng" }
            ];
            const subj = subjects[getRandomInt(0, subjects.length - 1)];

            // Setup s·ªë li·ªáu sao cho ƒë·∫πp
            const rate = getRandomInt(10, 50); // NƒÉng su·∫•t (v√≠ d·ª•: 20 trang/ph√∫t)
            
            const time1 = getRandomInt(2, 5); 
            const work1 = rate * time1;

            const time2 = getRandomInt(6, 12);
            const work2 = rate * time2;
            
            // ·∫®n time2, h·ªèi time2
            return {
                type: 'word',
                display: `M·ªôt ${subj.name} trong <b>${time1} ${subj.unit2}</b> ${subj.action} <b>${work1} ${subj.unit1}</b>.<br>H·ªèi ƒë·ªÉ ${subj.action} <b>${work2} ${subj.unit1}</b> th√¨ c·∫ßn bao nhi√™u <b>${subj.unit2}</b>?`,
                answer: time2,
                steps: [
                    `V√¨ s·ªë ${subj.unit1} v√† th·ªùi gian l√† hai ƒë·∫°i l∆∞·ª£ng t·ªâ l·ªá thu·∫≠n.`,
                    `Ta c√≥ t·ªâ l·ªá th·ª©c: ${toFracHTML('t_1', 't_2')} = ${toFracHTML('sp_1', 'sp_2')}`,
                    `Thay s·ªë: ${toFracHTML(time1, '?')} = ${toFracHTML(work1, work2)}`,
                    `Suy ra: ? = ${toFracHTML(`${time1} . ${work2}`, work1)}`,
                    `K·∫øt qu·∫£: ${time2} (${subj.unit2})`
                ],
                hint: "D√πng quy t·∫Øc nh√¢n ch√©o chia ngang."
            };
        }

        // --- Core UI Logic ---

        function setMode(mode) {
            currentMode = mode;
            // Update UI buttons
            document.querySelectorAll('.btn-mode').forEach(btn => btn.classList.remove('mode-active'));
            document.getElementById(`btn-${mode}`).classList.add('mode-active');
            
            nextQuestion();
        }

        function nextQuestion() {
            // Reset UI
            document.getElementById('feedback').classList.add('hidden');
            document.getElementById('user-answer').value = '';
            document.getElementById('user-answer').disabled = false;
            document.getElementById('user-answer').focus();
            
            // Reset Steps
            stepIndex = 0;
            const stepsContainer = document.getElementById('steps-container');
            stepsContainer.innerHTML = `<div class="text-gray-400 italic text-sm text-center mt-10">B·∫•m "G·ª£i √Ω b∆∞·ªõc sau" ƒë·ªÉ xem t·ª´ng b∆∞·ªõc gi·∫£i chi ti·∫øt...</div>`;
            
            const btnStep = document.getElementById('btn-show-step');
            btnStep.disabled = false;
            btnStep.classList.remove('opacity-50', 'cursor-not-allowed', 'bg-gray-400');
            btnStep.classList.add('bg-emerald-500', 'hover:bg-emerald-600');
            btnStep.innerHTML = '<i class="fas fa-eye mr-2"></i> G·ª£i √Ω b∆∞·ªõc sau';
            
            isAnswered = false;

            // Generate Question based on mode
            switch(currentMode) {
                case 'find_k': currentQuestion = genFindK(); break;
                case 'find_val': currentQuestion = genFindVal(); break;
                case 'word_simple': currentQuestion = genWordSimple(); break;
                case 'word_hard': currentQuestion = genWordHard(); break;
                default: currentQuestion = genFindK();
            }

            document.getElementById('question-text').innerHTML = currentQuestion.display;
        }

        function showNextStep() {
            const container = document.getElementById('steps-container');
            
            // Clear placeholder text on first click
            if (stepIndex === 0) container.innerHTML = '';

            if (stepIndex < currentQuestion.steps.length) {
                const stepDiv = document.createElement('div');
                // Animation & Styling
                stepDiv.className = 'step-item bg-gray-50 p-3 rounded-lg border-l-4 border-emerald-400 mb-2 shadow-sm';
                
                // Highlight last step (Answer)
                if (stepIndex === currentQuestion.steps.length - 1) {
                     stepDiv.classList.add('bg-emerald-50', 'border-emerald-600', 'font-bold', 'text-emerald-800');
                     stepDiv.innerHTML = `<span class="inline-block bg-emerald-600 text-white text-xs px-2 py-1 rounded mr-2 mb-1">ƒê√ÅP √ÅN</span><br>${currentQuestion.steps[stepIndex]}`;
                } else {
                     stepDiv.innerHTML = `<span class="text-gray-500 text-xs font-bold uppercase mr-2">B∆∞·ªõc ${stepIndex + 1}:</span> ${currentQuestion.steps[stepIndex]}`;
                }
                
                container.appendChild(stepDiv);
                
                // Auto scroll
                container.scrollTop = container.scrollHeight;
                
                stepIndex++;
            }

            // Disable button if done
            if (stepIndex >= currentQuestion.steps.length) {
                const btn = document.getElementById('btn-show-step');
                btn.disabled = true;
                btn.innerHTML = '<i class="fas fa-check mr-2"></i> ƒê√£ hi·ªán h·∫øt';
                btn.classList.remove('bg-emerald-500', 'hover:bg-emerald-600');
                btn.classList.add('bg-gray-400', 'opacity-50', 'cursor-not-allowed');
            }
        }

        function checkAnswer() {
            if (isAnswered) return;

            const input = document.getElementById('user-answer');
            const feedback = document.getElementById('feedback');
            
            // H·ªó tr·ª£ nh·∫≠p "20000" ho·∫∑c "20.000" ƒë·ªÅu ƒë∆∞·ª£c
            let rawVal = input.value.trim().replace(/\./g, '').replace(/,/g, '.'); 
            const val = parseFloat(rawVal);

            if (isNaN(val)) {
                alert("Vui l√≤ng nh·∫≠p m·ªôt s·ªë!");
                return;
            }

            isAnswered = true;
            input.disabled = true;

            // Ch·∫•p nh·∫≠n sai s·ªë nh·ªè (cho tr∆∞·ªùng h·ª£p th·∫≠p ph√¢n)
            if (Math.abs(val - currentQuestion.answer) < 0.1) {
                score += 10;
                document.getElementById('score').textContent = score;
                feedback.innerHTML = `
                    <div class="text-emerald-600 font-extrabold text-2xl mb-1"><i class="fas fa-check-circle"></i> CH√çNH X√ÅC!</div>
                    <div class="text-gray-600">ƒê√°p √°n l√† <b>${currentQuestion.answer}</b></div>
                `;
                feedback.className = "text-center fade-in mt-4 p-4 rounded-xl bg-green-100 border-2 border-green-300 shadow-md";
                
                // Show full steps if correct
                const revealInterval = setInterval(() => {
                    if(stepIndex < currentQuestion.steps.length) {
                        showNextStep();
                    } else {
                        clearInterval(revealInterval);
                    }
                }, 200);
                
            } else {
                feedback.innerHTML = `
                    <div class="text-red-500 font-extrabold text-2xl mb-1"><i class="fas fa-times-circle"></i> SAI R·ªíI!</div>
                    <div class="text-gray-800 text-lg mb-2">ƒê√°p √°n ƒë√∫ng: <strong>${currentQuestion.answer}</strong></div>
                    <div class="text-sm text-gray-500 bg-white inline-block px-3 py-1 rounded-full border">Xem h∆∞·ªõng d·∫´n chi ti·∫øt b√™n c·∫°nh nh√©! üëâ</div>
                `;
                feedback.className = "text-center fade-in mt-4 p-4 rounded-xl bg-red-50 border-2 border-red-200 shadow-md";
                
                // Auto reveal all steps if wrong
                const revealInterval = setInterval(() => {
                    if(stepIndex < currentQuestion.steps.length) {
                        showNextStep();
                    } else {
                        clearInterval(revealInterval);
                    }
                }, 800);
            }
            feedback.classList.remove('hidden');
        }

        // Init
        window.onload = () => {
            setMode('find_k');
        };

    </script>
</body>
</html>