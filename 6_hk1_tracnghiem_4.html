<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>√în t·∫≠p Chinh Ph·ª•c To√°n 6 HK1 - C√¢u 4</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap');
        body {
            font-family: 'Nunito', sans-serif;
            background-color: #f0f9ff; /* Blue background */
        }
        
        .option-card {
            transition: all 0.2s ease;
            touch-action: manipulation;
        }
        .option-card:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .option-card:active:not(:disabled) {
            transform: scale(0.98);
        }

        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Animations from old tool synced */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        .shake {
            animation: shake 0.3s ease-in-out;
        }

        @keyframes pop {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        .pop {
            animation: pop 0.2s ease-out;
        }

        .streak-fire {
            color: #ef4444;
            animation: burn 0.5s infinite alternate;
        }
        @keyframes burn {
            from { text-shadow: 0 0 2px #fca5a5, 0 -2px 4px #f87171; }
            to { text-shadow: 0 0 4px #fca5a5, 0 -4px 8px #ef4444; }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center py-6 px-4">

    <!-- Header -->
    <header class="w-full max-w-4xl text-center mb-6">
        <h1 class="text-2xl md:text-3xl font-extrabold text-blue-800 mb-2 uppercase drop-shadow-sm">
            <i class="fas fa-calculator mr-2"></i>√în t·∫≠p Chinh Ph·ª•c To√°n 6 HK1 - C√¢u 4
        </h1>
        <p class="text-blue-600 font-medium">Ch·ªß ƒë·ªÅ: √ù nghƒ©a c·ªßa s·ªë nguy√™n √¢m trong th·ª±c ti·ªÖn</p>
    </header>

    <!-- Main Container -->
    <div class="w-full max-w-4xl flex flex-col gap-6">
        
        <!-- Control Panel (Category Selection) -->
        <div class="bg-white rounded-xl shadow-md p-4">
            <p class="text-sm text-gray-500 mb-3 font-bold text-center uppercase">Ch·ªçn ch·ªß ƒë·ªÅ √¥n t·∫≠p</p>
            <div class="flex flex-wrap justify-center gap-2" id="category-buttons">
                <!-- Buttons injected by JS -->
            </div>
        </div>

        <!-- Stats Board (Synced Style) -->
        <div class="bg-white rounded-xl shadow-md p-4 grid grid-cols-4 gap-2 text-center select-none" id="stats-container">
            <!-- Stats injected by JS -->
        </div>

        <!-- Question Area -->
        <div class="bg-white rounded-2xl shadow-xl overflow-hidden relative min-h-[300px] border-b-4 border-blue-600">
            
            <!-- Question Badge -->
            <div class="absolute top-0 left-0 bg-blue-100 text-blue-800 px-4 py-1 rounded-br-xl text-xs font-bold uppercase z-10" id="badge-topic">
                T·ªïng h·ª£p
            </div>

            <div id="question-container" class="p-6 md:p-8 pt-10">
                <!-- Loading State -->
                <div id="loading" class="hidden flex flex-col items-center justify-center h-40">
                    <div class="animate-spin rounded-full h-10 w-10 border-b-2 border-blue-600"></div>
                    <p class="mt-2 text-gray-500">ƒêang t·∫°o c√¢u h·ªèi...</p>
                </div>

                <!-- Content -->
                <div id="quiz-content" class="fade-in">
                    <h2 id="question-text" class="text-xl md:text-2xl font-bold text-gray-800 mb-8 leading-relaxed text-center">
                        Nh·∫•n n√∫t b·∫Øt ƒë·∫ßu ƒë·ªÉ l√†m b√†i!
                    </h2>

                    <div id="options-grid" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- Options injected here -->
                    </div>

                    <!-- Khu v·ª±c hi·ªÉn th·ªã gi·∫£i th√≠ch inline (M·ªöI) -->
                    <div id="explanation-area" class="hidden mt-6 p-4 bg-yellow-50 border-l-4 border-yellow-400 rounded-r-lg text-gray-700 text-sm md:text-base fade-in">
                        <!-- N·ªôi dung gi·∫£i th√≠ch s·∫Ω ƒë∆∞·ª£c JS th√™m v√†o ƒë√¢y -->
                    </div>
                </div>
            </div>

            <!-- Footer / Controls -->
            <div class="bg-gray-50 p-4 border-t border-gray-100 flex items-center justify-between">
                <div id="feedback-inline" class="text-lg font-bold hidden pl-2"></div>
                <button id="btn-next" onclick="handleNextClick()" class="ml-auto bg-white border border-gray-300 text-gray-600 px-6 py-2 rounded-full font-bold hover:bg-gray-100 transition flex items-center shadow-sm">
                    B·ªè qua <i class="fas fa-forward ml-2"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Footer Info -->
    <footer class="mt-8 text-center text-gray-500 text-xs">
        <p>¬© Th·∫ßy Nguy·ªÖn Vi·ªát Ho√†ng - Tr∆∞·ªùng THCS Nguy·ªÖn An Kh∆∞∆°ng - daytoanthayhoang.github.io</p>
    </footer>

    <!-- Feedback Modal (Overlay for detailed explanation) -->
    <div id="feedback-overlay" class="fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center p-4 fade-in">
        <div class="bg-white rounded-2xl shadow-2xl max-w-lg w-full p-6 text-center relative">
            <div id="feedback-icon" class="text-6xl mb-4"></div>
            <h3 id="feedback-title" class="text-2xl font-bold mb-2"></h3>
            <p id="feedback-message" class="text-gray-700 mb-4 text-lg font-medium"></p>
            <div class="bg-blue-50 p-4 rounded-xl text-left mb-6">
                <p class="text-xs text-blue-500 font-bold uppercase mb-1">Gi·∫£i th√≠ch:</p>
                <p id="feedback-detail" class="text-gray-800 text-sm leading-relaxed"></p>
            </div>
            <button onclick="closeModal()" class="w-full py-3 bg-blue-600 text-white font-bold rounded-xl shadow-lg hover:bg-blue-700 transition transform hover:-translate-y-1">
                ƒê√≥ng ƒë·ªÉ xem l·∫°i <i class="fas fa-times ml-2"></i>
            </button>
        </div>
    </div>

    <script>
        // --- DATA SOURCE (70% Core Content) ---
        const referenceQuestions = [
            // 1. NHI·ªÜT ƒê·ªò
            {
                type: 'nhietdo',
                question: "V√†o m√πa ƒë√¥ng, nhi·ªát ƒë·ªô trung b√¨nh c·ªßa B·∫Øc C·ª±c kho·∫£ng -40¬∞C, c√≤n nhi·ªát ƒë·ªô trung b√¨nh c·ªßa Nam C·ª±c kho·∫£ng -60¬∞C. N∆°i n√†o l·∫°nh h∆°n?",
                options: ["Nam C·ª±c", "B·∫Øc C·ª±c", "C·∫£ hai n∆°i l·∫°nh nh∆∞ nhau", "Kh√¥ng c√≥ n∆°i n√†o l·∫°nh h∆°n"],
                correct: 0,
                explanation: "V√¨ -60 < -40 n√™n -60¬∞C l·∫°nh h∆°n -40¬∞C. Do ƒë√≥ Nam C·ª±c l·∫°nh h∆°n."
            },
            {
                type: 'nhietdo',
                question: "N·∫øu 20¬∞C bi·ªÉu di·ªÖn 20 ƒë·ªô tr√™n 0¬∞C th√¨ -5¬∞C bi·ªÉu di·ªÖn ƒëi·ªÅu g√¨?",
                options: ["5¬∞C d∆∞·ªõi 0¬∞C", "-5¬∞C tr√™n 0¬∞C", "-5¬∞C d∆∞·ªõi 0¬∞C", "5¬∞C tr√™n 0¬∞C"],
                correct: 0,
                explanation: "S·ªë nguy√™n √¢m trong nhi·ªát ƒë·ªô d√πng ƒë·ªÉ ch·ªâ nhi·ªát ƒë·ªô d∆∞·ªõi 0¬∞C. Do ƒë√≥ -5¬∞C l√† 5 ƒë·ªô d∆∞·ªõi 0¬∞C."
            },
            {
                type: 'nhietdo',
                question: "Trong c√°c c√°ch di·ªÖn ƒë·∫°t sau v·ªÅ nhi·ªát ƒë·ªô ngƒÉn ƒë√° t·ªß l·∫°nh, c√°ch ghi n√†o l√† ƒê√öNG v·ªõi quy ∆∞·ªõc to√°n h·ªçc?",
                options: ["-5¬∞C", "05¬∞C (ƒë·ªÉ ch·ªâ d∆∞·ªõi 0)", "5¬∞C d∆∞·ªõi 0", "C·∫£ A v√† C ƒë·ªÅu ch·∫•p nh·∫≠n ƒë∆∞·ª£c v·ªÅ m·∫∑t ng·ªØ nghƒ©a"],
                correct: 3,
                explanation: "C√°ch ghi s·ªë h·ªçc ch√≠nh x√°c l√† -5¬∞C. Tuy nhi√™n trong vƒÉn n√≥i c√≥ th·ªÉ d√πng '5 ƒë·ªô d∆∞·ªõi 0'."
            },
            {
                type: 'nhietdo',
                question: "T√¨m l·ªói SAI trong c√°ch bi·ªÉu di·ªÖn sau: 'Nhi·ªát ƒë·ªô ngƒÉn ƒë√° l√† 5 ƒë·ªô d∆∞·ªõi 0¬∞C n√™n ƒë∆∞·ª£c vi·∫øt l√† 05¬∞C'.",
                options: ["Sai, ph·∫£i vi·∫øt l√† -5¬∞C", "Sai, ph·∫£i vi·∫øt l√† +5¬∞C", "ƒê√∫ng, kh√¥ng c√≥ l·ªói sai", "Sai, ph·∫£i vi·∫øt l√† 50¬∞C"],
                correct: 0,
                explanation: "Nhi·ªát ƒë·ªô d∆∞·ªõi 0¬∞C ph·∫£i s·ª≠ d·ª•ng d·∫•u tr·ª´ (-) ƒë·∫±ng tr∆∞·ªõc."
            },
            
            // 2. ƒê·ªò CAO / ƒê·ªò S√ÇU
            {
                type: 'docao',
                question: "Ph√°t bi·ªÉu n√†o sau ƒë√¢y l√† SAI v·ªÅ vi·ªác d√πng s·ªë nguy√™n ƒë·ªÉ bi·ªÉu di·ªÖn ƒë·ªô cao th·ª±c t·∫ø?",
                options: ["ƒê·ªânh n√∫i B·∫°ch M·ªôc L∆∞∆°ng T·ª≠ cao -3046m", "ƒê√°y s√¥ng S√†i G√≤n c√≥ ƒë·ªô cao -20m", "ƒê·ªânh Phan-xi-pƒÉng cao 3143m", "Th·ªÅm l·ª•c ƒë·ªãa s√¢u 60m c√≥ ƒë·ªô cao -60m"],
                correct: 0,
                explanation: "ƒê·ªô cao c·ªßa n√∫i so v·ªõi m·ª±c n∆∞·ªõc bi·ªÉn l√† d∆∞∆°ng. Ph·∫£i vi·∫øt l√† 3046m, kh√¥ng ƒë∆∞·ª£c d√πng s·ªë √¢m."
            },
            {
                type: 'docao',
                question: "T√¨m c√°ch bi·ªÉu di·ªÖn SAI trong c√°c c√¢u sau:",
                options: ["ƒê·ªânh Phan-xi-pƒÉng cao -3143m", "ƒê√°y s√¥ng S√†i G√≤n ·ªü ƒë·ªô cao -20m", "M·ª±c n∆∞·ªõc bi·ªÉn l√† 0m", "M√°y bay ƒëang bay ·ªü ƒë·ªô cao 5000m"],
                correct: 0,
                explanation: "ƒê·ªânh n√∫i cao h∆°n m·ª±c n∆∞·ªõc bi·ªÉn n√™n ph·∫£i bi·ªÉu di·ªÖn b·∫±ng s·ªë nguy√™n d∆∞∆°ng (+3143 ho·∫∑c 3143)."
            },
            {
                type: 'docao',
                question: "C√¢u n√†o d∆∞·ªõi ƒë√¢y bi·ªÉu di·ªÖn ƒë√∫ng c√°c s·ªë li·ªáu: 'ƒê·ªânh Phan-xi-pƒÉng cao 3143m, ƒë√°y s√¥ng S√†i G√≤n s√¢u 20m'?",
                options: ["+3143 v√† -20", "-3143 v√† +20", "+3143 v√† +20", "-3143 v√† -20"],
                correct: 0,
                explanation: "ƒê·ªô cao tr√™n m·ª±c n∆∞·ªõc bi·ªÉn l√† d∆∞∆°ng (+), ƒë·ªô s√¢u d∆∞·ªõi m·ª±c n∆∞·ªõc bi·ªÉn l√† √¢m (-)."
            },
            {
                type: 'docao',
                question: "Nh·∫≠n ƒë·ªãnh n√†o sau ƒë√¢y l√† SAI?",
                options: ["ƒê·ªô cao ƒë√°y v·ªãnh Cam Ranh l√† 32m", "ƒê·ªô cao ƒë√°y v·ªãnh Cam Ranh l√† -32m", "V·ªãnh Cam Ranh s√¢u 32m", "M·ª±c n∆∞·ªõc bi·ªÉn l√†m m·ªëc 0"],
                correct: 0,
                explanation: "N·∫øu n√≥i v·ªÅ 'ƒê·ªô cao' c·ªßa ƒë√°y (d∆∞·ªõi m·∫∑t n∆∞·ªõc) th√¨ ph·∫£i d√πng s·ªë √¢m (-32m). N·∫øu n√≥i 'S√¢u' th√¨ d√πng s·ªë d∆∞∆°ng (s√¢u 32m). C√°ch vi·∫øt 'ƒê·ªô cao... l√† 32m' l√† sai nghƒ©a."
            },

            // 3. L·ªäCH S·ª¨ (NƒÇM)
            {
                type: 'lichsu',
                question: "Archimedes sinh nƒÉm 287 tr∆∞·ªõc C√¥ng nguy√™n v√† m·∫•t nƒÉm 212 tr∆∞·ªõc C√¥ng nguy√™n. S·ªë nguy√™n bi·ªÉu th·ªã nƒÉm sinh v√† nƒÉm m·∫•t c·ªßa √¥ng l·∫ßn l∆∞·ª£t l√†:",
                options: ["-287 v√† -212", "287 v√† 212", "-287 v√† 212", "287 v√† -212"],
                correct: 0,
                explanation: "NƒÉm tr∆∞·ªõc C√¥ng nguy√™n (TCN) ƒë∆∞·ª£c bi·ªÉu di·ªÖn b·∫±ng s·ªë nguy√™n √¢m."
            },
            {
                type: 'lichsu',
                question: "T√¨m l·ªói SAI trong bi·ªÉu di·ªÖn nƒÉm sinh c·ªßa nh√† to√°n h·ªçc L∆∞∆°ng Th·∫ø Vinh (sinh nƒÉm 1441 sau C√¥ng nguy√™n):",
                options: ["Vi·∫øt l√† -1441", "Vi·∫øt l√† 1441", "Vi·∫øt l√† +1441", "√îng sinh v√†o th·∫ø k·ª∑ 15"],
                correct: 0,
                explanation: "NƒÉm sau C√¥ng nguy√™n l√† s·ªë d∆∞∆°ng. Vi·∫øt -1441 l√† sai v√¨ n√≥ nghƒ©a l√† nƒÉm 1441 TCN."
            },
            {
                type: 'lichsu',
                question: "Nh√† to√°n h·ªçc Thales sinh nƒÉm 624 TCN. C√°ch bi·ªÉu di·ªÖn n√†o sau ƒë√¢y l√† SAI?",
                options: ["+624", "-624", "624 tr∆∞·ªõc C√¥ng nguy√™n", "NƒÉm √¢m 624"],
                correct: 0,
                explanation: "NƒÉm TCN ph·∫£i bi·ªÉu di·ªÖn b·∫±ng s·ªë √¢m. Vi·∫øt +624 l√† sai."
            },
            {
                type: 'lichsu',
                question: "Nh√† to√°n h·ªçc Pythagore sinh nƒÉm 570 TCN. S·ªë nguy√™n bi·ªÉu di·ªÖn nƒÉm sinh c·ªßa √¥ng l√†:",
                options: ["-570", "570", "-570 TCN", "570 SCN"],
                correct: 0,
                explanation: "NƒÉm 570 TCN t∆∞∆°ng ·ª©ng v·ªõi s·ªë nguy√™n -570."
            },
            {
                type: 'lichsu',
                question: "Th·∫ø v·∫≠n h·ªôi ƒë·∫ßu ti√™n di·ªÖn ra nƒÉm 776 tr∆∞·ªõc C√¥ng nguy√™n. S·ªë nguy√™n ch·ªâ nƒÉm n√†y l√†:",
                options: ["-776", "776", "0", "-767"],
                correct: 0,
                explanation: "Tr∆∞·ªõc C√¥ng nguy√™n t∆∞∆°ng ·ª©ng v·ªõi s·ªë √¢m."
            },

            // 4. T√ÄI CH√çNH / L·ª¢I NHU·∫¨N
            {
                type: 'taichinh',
                question: "C·ª≠a h√†ng qu·∫ßn √°o t·ªïng k·∫øt th·∫•y 'l·ªùi 423 tri·ªáu'. S·ªë nguy√™n bi·ªÉu di·ªÖn k·∫øt qu·∫£ kinh doanh n√†y l√†:",
                options: ["423 tri·ªáu", "-423 tri·ªáu", "0 tri·ªáu", "423 ngh√¨n"],
                correct: 0,
                explanation: "Ti·ªÅn l·ªùi (l·ª£i nhu·∫≠n d∆∞∆°ng) ƒë∆∞·ª£c bi·ªÉu di·ªÖn b·∫±ng s·ªë d∆∞∆°ng."
            },
            {
                type: 'taichinh',
                question: "M·∫π Lan r√∫t 3.000.000 ƒë·ªìng t·ª´ th·∫ª ATM. S·ªë nguy√™n bi·ªÉu di·ªÖn bi·∫øn ƒë·ªông s·ªë d∆∞ trong t√†i kho·∫£n l√†:",
                options: ["-3.000.000", "3.000.000", "-300.000", "+3.000.000"],
                correct: 0,
                explanation: "R√∫t ti·ªÅn (ti·ªÅn ƒëi ra kh·ªèi t√†i kho·∫£n) bi·ªÉu di·ªÖn b·∫±ng s·ªë √¢m."
            },
             {
                type: 'taichinh',
                question: "M·ªôt c√¥ng ty b√°o c√°o l·ªó 50 tri·ªáu ƒë·ªìng. S·ªë nguy√™n bi·ªÉu di·ªÖn l·ª£i nhu·∫≠n c·ªßa c√¥ng ty l√†:",
                options: ["-50 tri·ªáu", "50 tri·ªáu", "+50 tri·ªáu", "Kh√¥ng x√°c ƒë·ªãnh"],
                correct: 0,
                explanation: "L·ªó (ng∆∞·ª£c l·∫°i v·ªõi l√£i) ƒë∆∞·ª£c bi·ªÉu di·ªÖn b·∫±ng s·ªë nguy√™n √¢m."
            }
        ];

        // --- PROCEDURAL GENERATORS (30% Expanded Content) ---
        const generators = {
            nhietdo: () => {
                // T·ª∑ l·ªá xu·∫•t hi·ªán: 40% h·ªèi √Ω nghƒ©a, 60% h·ªèi so s√°nh ƒë·ªãa ƒëi·ªÉm (ph√°t tri·ªÉn th√™m)
                const type = Math.random() < 0.4 ? 'meaning' : 'compare';

                if (type === 'meaning') {
                    const temp = randomInt(2, 35);
                    const val = -temp; 
                    return {
                        type: 'nhietdo',
                        question: `B·∫£n tin th·ªùi ti·∫øt th√¥ng b√°o nhi·ªát ƒë·ªô t·∫°i m·ªôt th√†nh ph·ªë l√† <b>${val}¬∞C</b>. ƒêi·ªÅu n√†y c√≥ nghƒ©a l√†:`,
                        options: [
                            `Nhi·ªát ƒë·ªô l√† ${temp} ƒë·ªô d∆∞·ªõi 0¬∞C`,
                            `Nhi·ªát ƒë·ªô l√† ${temp} ƒë·ªô tr√™n 0¬∞C`,
                            `Nhi·ªát ƒë·ªô l√† ${val} ƒë·ªô tr√™n 0¬∞C`, 
                            `Nhi·ªát ƒë·ªô l√† 0¬∞C tr·ª´ ƒëi ${val} ƒë·ªô`
                        ],
                        correct: 0,
                        explanation: `S·ªë nguy√™n √¢m (v√≠ d·ª• ${val}) d√πng ƒë·ªÉ ch·ªâ nhi·ªát ƒë·ªô d∆∞·ªõi m·ªëc 0¬∞C. Do ƒë√≥ ${val}¬∞C nghƒ©a l√† ${temp} ƒë·ªô d∆∞·ªõi 0¬∞C.`
                    };
                } else {
                    // D·ªØ li·ªáu ƒë·ªãa ƒëi·ªÉm phong ph√∫
                    const places = [
                        { name: "NgƒÉn ƒë√° t·ªß l·∫°nh", tMin: -18, tMax: -10 },
                        { name: "B·∫Øc C·ª±c", tMin: -40, tMax: -20 },
                        { name: "ƒê·ªânh Everest (ƒë√™m)", tMin: -30, tMax: -15 },
                        { name: "Th√†nh ph·ªë Moscow (Nga)", tMin: -25, tMax: -5 },
                        { name: "Sapa (m√πa ƒë√¥ng)", tMin: -2, tMax: 5 },
                        { name: "H√† N·ªôi (m√πa ƒë√¥ng)", tMin: 10, tMax: 20 },
                        { name: "Sa m·∫°c Sahara (ƒë√™m)", tMin: -5, tMax: 5 },
                        { name: "Th√†nh ph·ªë Tokyo", tMin: -5, tMax: 8 }
                    ];

                    // Ch·ªçn 2 ƒë·ªãa ƒëi·ªÉm ng·∫´u nhi√™n
                    let idx1 = randomInt(0, places.length - 1);
                    let idx2 = randomInt(0, places.length - 1);
                    while (idx1 === idx2) idx2 = randomInt(0, places.length - 1);

                    const p1 = places[idx1];
                    const p2 = places[idx2];

                    // Sinh nhi·ªát ƒë·ªô c·ª• th·ªÉ cho t·ª´ng n∆°i
                    const t1 = randomInt(p1.tMin, p1.tMax);
                    let t2 = randomInt(p2.tMin, p2.tMax);
                    
                    // ƒê·∫£m b·∫£o nhi·ªát ƒë·ªô kh√°c nhau ƒë·ªÉ so s√°nh
                    while (t1 === t2) t2 = randomInt(p2.tMin, p2.tMax);

                    const isAskColder = Math.random() < 0.5; // true: h·ªèi l·∫°nh h∆°n, false: h·ªèi ·∫•m h∆°n
                    
                    // T·∫°o c√¢u h·ªèi
                    const qText = `Nhi·ªát ƒë·ªô t·∫°i <b>${p1.name}</b> ƒëo ƒë∆∞·ª£c l√† ${t1}¬∞C. Nhi·ªát ƒë·ªô t·∫°i <b>${p2.name}</b> l√† ${t2}¬∞C. Theo b·∫°n, n∆°i n√†o ${isAskColder ? '<b>l·∫°nh h∆°n</b>' : '<b>·∫•m h∆°n</b>'}?`;

                    // X√°c ƒë·ªãnh ƒë√°p √°n
                    let correctIndex;
                    let reason = "";
                    
                    if (isAskColder) {
                        // L·∫°nh h∆°n = nhi·ªát ƒë·ªô th·∫•p h∆°n (nh·ªè h∆°n)
                        if (t1 < t2) {
                            correctIndex = 0; // p1
                            reason = `V√¨ ${t1} < ${t2} n√™n nhi·ªát ƒë·ªô t·∫°i ${p1.name} th·∫•p h∆°n. Nhi·ªát ƒë·ªô c√†ng th·∫•p th√¨ c√†ng l·∫°nh.`;
                        } else {
                            correctIndex = 1; // p2
                            reason = `V√¨ ${t2} < ${t1} n√™n nhi·ªát ƒë·ªô t·∫°i ${p2.name} th·∫•p h∆°n. Nhi·ªát ƒë·ªô c√†ng th·∫•p th√¨ c√†ng l·∫°nh.`;
                        }
                    } else {
                        // ·∫§m h∆°n = nhi·ªát ƒë·ªô cao h∆°n (l·ªõn h∆°n)
                        if (t1 > t2) {
                            correctIndex = 0; // p1
                            reason = `V√¨ ${t1} > ${t2} n√™n nhi·ªát ƒë·ªô t·∫°i ${p1.name} cao h∆°n (·∫•m h∆°n).`;
                        } else {
                            correctIndex = 1; // p2
                            reason = `V√¨ ${t2} > ${t1} n√™n nhi·ªát ƒë·ªô t·∫°i ${p2.name} cao h∆°n (·∫•m h∆°n).`;
                        }
                    }

                    return {
                        type: 'nhietdo',
                        question: qText,
                        options: [
                            p1.name,
                            p2.name,
                            "C·∫£ hai n∆°i nh∆∞ nhau",
                            "Ch∆∞a ƒë·ªß d·ªØ ki·ªán ƒë·ªÉ so s√°nh"
                        ],
                        correct: correctIndex,
                        explanation: `So s√°nh hai s·ªë nguy√™n: ${t1} v√† ${t2}.<br>${reason}`
                    };
                }
            },
            docao: () => {
                const items = [
                    { name: "T√†u ng·∫ßm", verb: "l·∫∑n ·ªü ƒë·ªô s√¢u", val: Math.floor(Math.random() * 500) + 100 },
                    { name: "Th·ª£ l·∫∑n", verb: "l·∫∑n s√¢u", val: Math.floor(Math.random() * 30) + 10 },
                    { name: "R·∫°n san h√¥", verb: "n·∫±m ·ªü ƒë·ªô s√¢u", val: Math.floor(Math.random() * 20) + 5 }
                ];
                const item = items[Math.floor(Math.random() * items.length)];
                return {
                    type: 'docao',
                    question: `M·ªôt ${item.name.toLowerCase()} ƒëang ${item.verb} ${item.val}m so v·ªõi m·ª±c n∆∞·ªõc bi·ªÉn. S·ªë nguy√™n bi·ªÉu di·ªÖn ƒë·ªô cao l√†:`,
                    options: [`-${item.val}`, `+${item.val}`, `${item.val}`, `0`],
                    correct: 0,
                    explanation: "ƒê·ªô s√¢u d∆∞·ªõi m·ª±c n∆∞·ªõc bi·ªÉn ƒë∆∞·ª£c bi·ªÉu di·ªÖn b·∫±ng s·ªë nguy√™n √¢m."
                };
            },
            lichsu: () => {
                const year = Math.floor(Math.random() * 900) + 100;
                return {
                    type: 'lichsu',
                    question: `M·ªôt s·ª± ki·ªán l·ªãch s·ª≠ di·ªÖn ra v√†o nƒÉm ${year} tr∆∞·ªõc C√¥ng nguy√™n. S·ªë nguy√™n bi·ªÉu di·ªÖn nƒÉm ƒë√≥ l√†:`,
                    options: [`-${year}`, `${year}`, `+${year}`, `1-${year}`],
                    correct: 0,
                    explanation: "NƒÉm tr∆∞·ªõc C√¥ng nguy√™n (TCN) ƒë∆∞·ª£c quy ∆∞·ªõc l√† s·ªë nguy√™n √¢m."
                };
            },
            taichinh: () => {
                const money = (Math.floor(Math.random() * 50) + 1) * 100000;
                const isDebt = Math.random() > 0.5;
                if (isDebt) {
                    return {
                        type: 'taichinh',
                        question: `√îng An ƒëang n·ª£ ng√¢n h√†ng ${money.toLocaleString('vi-VN')} ƒë·ªìng. S·ªë nguy√™n bi·ªÉu di·ªÖn s·ªë ti·ªÅn c·ªßa √¥ng An l√†:`,
                        options: [`-${money.toLocaleString('vi-VN')}`, `${money.toLocaleString('vi-VN')}`, `+${money.toLocaleString('vi-VN')}`, `0`],
                        correct: 0,
                        explanation: "Kho·∫£n n·ª£ ƒë∆∞·ª£c bi·ªÉu di·ªÖn b·∫±ng s·ªë nguy√™n √¢m."
                    };
                } else {
                     return {
                        type: 'taichinh',
                        question: `Kinh doanh thua l·ªó ${money.toLocaleString('vi-VN')} ƒë·ªìng. S·ªë nguy√™n bi·ªÉu di·ªÖn l·ª£i nhu·∫≠n l√†:`,
                        options: [`-${money.toLocaleString('vi-VN')}`, `${money.toLocaleString('vi-VN')}`, `+${money.toLocaleString('vi-VN')}`, `~${money.toLocaleString('vi-VN')}`],
                        correct: 0,
                        explanation: "Thua l·ªó (l·ª£i nhu·∫≠n √¢m) ƒë∆∞·ª£c bi·ªÉu di·ªÖn b·∫±ng d·∫•u tr·ª´."
                    };
                }
            },
            khac: () => {
                // Expanded logic for 'khac' to include Elevator, Vision, Football
                const subType = Math.random();
                
                if (subType < 0.33) {
                    // 1. Thang m√°y: Ph√©p to√°n di chuy·ªÉn
                    const start = randomInt(5, 15); // T·∫ßng b·∫Øt ƒë·∫ßu (5-15)
                    const down = randomInt(start + 1, start + 5); // ƒêi xu·ªëng nhi·ªÅu h∆°n t·∫ßng hi·ªán t·∫°i ƒë·ªÉ ra √¢m
                    const end = start - down;
                    
                    return {
                        type: 'khac',
                        question: `Thang m√°y ƒëang ·ªü t·∫ßng <b>${start}</b>, sau ƒë√≥ ƒëi xu·ªëng <b>${down}</b> t·∫ßng. V·ªã tr√≠ c·ªßa thang m√°y l√∫c n√†y ƒë∆∞·ª£c bi·ªÉu di·ªÖn b·ªüi s·ªë nguy√™n n√†o? (Bi·∫øt t·∫ßng G l√† 0)`,
                        options: [
                            `${end}`, 
                            `+${end}`, 
                            `T·∫ßng ${Math.abs(end)}`, 
                            `${start + down}`
                        ],
                        correct: 0,
                        explanation: `V·ªã tr√≠ m·ªõi = V·ªã tr√≠ c≈© - S·ªë t·∫ßng ƒëi xu·ªëng = ${start} - ${down} = ${end}. (S·ªë √¢m bi·ªÉu th·ªã t·∫ßng h·∫ßm)`
                    };
                } else if (subType < 0.66) {
                    // 2. ƒê·ªô c·∫≠n th·ªã (M·∫Øt)
                    const diop = (randomInt(1, 4) + (Math.random() < 0.5 ? 0.5 : 0)).toFixed(1); // V√≠ d·ª• 2.5, 3.0
                    return {
                        type: 'khac',
                        question: `B·∫°n Lan ƒëi kh√°m m·∫Øt v√† b√°c sƒ© k·∫øt lu·∫≠n b·∫°n b·ªã <b>c·∫≠n th·ªã ${diop} ƒë·ªô</b>. Trong y h·ªçc, ƒë·ªô c·∫≠n th·ªã c·ªßa Lan ƒë∆∞·ª£c bi·ªÉu di·ªÖn b·∫±ng s·ªë:`,
                        options: [
                            `-${diop} diop`, 
                            `+${diop} diop`, 
                            `${diop} diop`, 
                            `0 diop`
                        ],
                        correct: 0,
                        explanation: "Trong quy ∆∞·ªõc y h·ªçc: ƒê·ªô c·∫≠n th·ªã ƒë∆∞·ª£c bi·ªÉu di·ªÖn b·∫±ng s·ªë nguy√™n √¢m (-), ƒë·ªô vi·ªÖn th·ªã l√† s·ªë d∆∞∆°ng (+)."
                    };
                } else {
                    // 3. Hi·ªáu s·ªë b√†n th·∫Øng (B√≥ng ƒë√°)
                    const banThang = randomInt(0, 3);
                    const banThua = randomInt(banThang + 2, banThang + 5); // Thua nhi·ªÅu h∆°n th·∫Øng ƒë·ªÉ ra hi·ªáu s·ªë √¢m
                    const hieuSo = banThang - banThua;
                    
                    return {
                        type: 'khac',
                        question: `K·∫øt th√∫c v√≤ng b·∫£ng, ƒë·ªôi b√≥ng A ghi ƒë∆∞·ª£c <b>${banThang}</b> b√†n th·∫Øng nh∆∞ng b·ªã th·ªßng l∆∞·ªõi <b>${banThua}</b> b√†n. Hi·ªáu s·ªë b√†n th·∫Øng - thua c·ªßa ƒë·ªôi A l√†:`,
                        options: [
                            `${hieuSo}`, 
                            `+${hieuSo}`, 
                            `${Math.abs(hieuSo)}`, 
                            `0`
                        ],
                        correct: 0,
                        explanation: `Hi·ªáu s·ªë = B√†n th·∫Øng - B√†n thua = ${banThang} - ${banThua} = ${hieuSo}.`
                    };
                }
            }
        };

        // --- APP STATE ---
        const state = {
            currentCategory: 'all',
            streak: 0,
            correct: 0,
            wrong: 0,
            skipped: 0,
            currentQuestion: null,
            isAnswered: false
        };

        // --- CORE FUNCTIONS ---
        
        // Th√™m h√†m randomInt ti·ªán d·ª•ng
        function randomInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function renderStats() {
            const container = document.getElementById('stats-container');
            container.innerHTML = `
                <div class="flex flex-col items-center">
                    <span class="text-xs text-gray-500 uppercase font-bold">Chu·ªói th·∫Øng üî•</span>
                    <span class="text-3xl font-extrabold ${state.streak > 2 ? 'streak-fire' : 'text-blue-900'}">
                        ${state.streak > 2 ? '<i class="fas fa-fire"></i> ' : ''}${state.streak}
                    </span>
                </div>
                <div class="flex flex-col items-center border-l border-gray-200">
                    <span class="text-xs text-gray-500 uppercase font-bold">ƒê√∫ng</span>
                    <span class="text-xl font-bold text-green-600">${state.correct}</span>
                </div>
                <div class="flex flex-col items-center border-l border-gray-200">
                    <span class="text-xs text-gray-500 uppercase font-bold">Sai</span>
                    <span class="text-xl font-bold text-red-500">${state.wrong}</span>
                </div>
                <div class="flex flex-col items-center border-l border-gray-200">
                    <span class="text-xs text-gray-500 uppercase font-bold">B·ªè qua</span>
                    <span class="text-xl font-bold text-gray-400">${state.skipped}</span>
                </div>
            `;
        }

        function getQuestion(category) {
            const useReference = Math.random() < 0.6; // Gi·∫£m t·ªâ l·ªá l·∫•y c√¢u h·ªèi tƒ©nh xu·ªëng ch√∫t ƒë·ªÉ tƒÉng t√≠nh ƒëa d·∫°ng
            let pool = [];
            
            if (useReference) {
                if (category === 'all') pool = referenceQuestions;
                else pool = referenceQuestions.filter(q => q.type === category);
            }

            if (useReference && pool.length > 0) {
                const q = pool[Math.floor(Math.random() * pool.length)];
                return JSON.parse(JSON.stringify(q));
            }

            let generatorType = category;
            if (category === 'all') {
                const keys = Object.keys(generators);
                generatorType = keys[Math.floor(Math.random() * keys.length)];
            }
            
            // Fallback n·∫øu generatorType kh√¥ng t·ªìn t·∫°i (v√≠ d·ª• 'all' random ra c√°i ch∆∞a c√≥)
            return generators[generatorType] ? generators[generatorType]() : generators['nhietdo']();
        }

        function initCategoryButtons() {
            const categories = [
                { id: 'all', label: 'T·ªïng h·ª£p', icon: 'fa-layer-group', color: 'bg-indigo-600' },
                { id: 'nhietdo', label: 'Nhi·ªát ƒë·ªô', icon: 'fa-temperature-low', color: 'bg-blue-500' },
                { id: 'docao', label: 'ƒê·ªô cao/S√¢u', icon: 'fa-mountain', color: 'bg-emerald-500' },
                { id: 'lichsu', label: 'L·ªãch s·ª≠', icon: 'fa-hourglass-half', color: 'bg-amber-600' },
                { id: 'taichinh', label: 'T√†i ch√≠nh', icon: 'fa-coins', color: 'bg-rose-500' },
                { id: 'khac', label: 'Th·ª±c t·∫ø kh√°c', icon: 'fa-globe-asia', color: 'bg-purple-600' } // N√∫t m·ªõi
            ];

            const container = document.getElementById('category-buttons');
            container.innerHTML = categories.map(cat => `
                <button onclick="changeCategory('${cat.id}')" 
                    class="category-btn ${cat.id === 'all' ? 'ring-2 ring-offset-2 ring-blue-400' : ''} 
                           flex items-center gap-2 px-3 py-2 rounded-lg text-white text-sm font-bold shadow-md 
                           ${cat.color} hover:opacity-90 transition-all">
                    <i class="fas ${cat.icon}"></i> ${cat.label}
                </button>
            `).join('');
        }

        function changeCategory(id) {
            state.currentCategory = id;
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('ring-2', 'ring-offset-2', 'ring-blue-400');
            });
            event.currentTarget.classList.add('ring-2', 'ring-offset-2', 'ring-blue-400');
            generateNewQuestion(true); // Skip stats logic when changing category
        }

        function generateNewQuestion(skipStats = false) {
            state.isAnswered = false;
            
            // Reset UI
            document.getElementById('feedback-inline').className = "hidden";
            const btnNext = document.getElementById('btn-next');
            btnNext.innerHTML = 'B·ªè qua <i class="fas fa-forward ml-2"></i>';
            btnNext.className = "ml-auto bg-white border border-gray-300 text-gray-600 px-6 py-2 rounded-full font-bold hover:bg-gray-100 transition flex items-center shadow-sm";
            
            // ·∫®n v√πng gi·∫£i th√≠ch inline khi sang c√¢u m·ªõi
            const explArea = document.getElementById('explanation-area');
            explArea.classList.add('hidden');
            explArea.innerHTML = '';

            // Get Question
            const mapName = {
                'all': 'T·ªïng h·ª£p', 'nhietdo': 'Nhi·ªát ƒë·ªô', 'docao': 'ƒê·ªô cao/S√¢u', 
                'lichsu': 'L·ªãch s·ª≠', 'taichinh': 'T√†i ch√≠nh', 'khac': 'Th·ª±c t·∫ø kh√°c'
            };
            
            const q = getQuestion(state.currentCategory);
            const correctAnswerText = q.options[q.correct];
            let shuffledOptions = [...q.options];
            shuffleArray(shuffledOptions);
            const newCorrectIndex = shuffledOptions.indexOf(correctAnswerText);
            
            state.currentQuestion = {
                ...q,
                options: shuffledOptions,
                correct: newCorrectIndex,
                originalType: q.type
            };

            // Render
            document.getElementById('badge-topic').innerText = mapName[state.currentQuestion.originalType || state.currentCategory] || 'T·ªïng h·ª£p';
            document.getElementById('question-text').innerHTML = state.currentQuestion.question; // Changed to innerHTML to support bold tags
            
            const optionsHtml = state.currentQuestion.options.map((opt, index) => `
                <button onclick="checkAnswer(this, ${index})" 
                    class="option-card w-full text-left p-4 rounded-xl border-2 border-gray-100 bg-blue-50 hover:border-blue-300 hover:bg-blue-100 text-gray-700 font-semibold relative overflow-hidden group">
                    <span class="inline-block w-8 h-8 rounded-full bg-white text-center leading-8 mr-3 text-blue-600 font-bold shadow-sm group-hover:bg-blue-600 group-hover:text-white transition">
                        ${String.fromCharCode(65 + index)}
                    </span>
                    ${opt}
                </button>
            `).join('');
            
            document.getElementById('options-grid').innerHTML = optionsHtml;
        }

        function checkAnswer(btn, selectedIndex) {
            if (state.isAnswered) return;
            state.isAnswered = true;

            const isCorrect = selectedIndex === state.currentQuestion.correct;
            const inlineFeedback = document.getElementById('feedback-inline');
            const overlay = document.getElementById('feedback-overlay');
            const icon = document.getElementById('feedback-icon');
            const title = document.getElementById('feedback-title');
            const msg = document.getElementById('feedback-message');
            const detail = document.getElementById('feedback-detail');

            // Disable all buttons
            const allBtns = document.querySelectorAll('.option-card');
            allBtns.forEach(b => {
                b.disabled = true;
                b.classList.add('opacity-75');
            });

            // 1. LU√îN LU√îN T√î ƒê·∫¨M ƒê√ÅP √ÅN ƒê√öNG (D√π ch·ªçn ƒë√∫ng hay sai)
            const correctBtn = allBtns[state.currentQuestion.correct];
            correctBtn.classList.remove('bg-blue-50', 'border-gray-100', 'hover:border-blue-300', 'hover:bg-blue-100', 'opacity-75');
            correctBtn.classList.add('bg-green-100', 'border-green-500', 'text-green-800', 'opacity-100', 'border-2');
            
            const correctSpan = correctBtn.querySelector('span');
            correctSpan.classList.remove('text-blue-600', 'bg-white', 'group-hover:bg-blue-600', 'group-hover:text-white');
            correctSpan.classList.add('bg-green-600', 'text-white');


            if (isCorrect) {
                state.score++;
                state.streak++;
                state.correct++;
                
                // N·∫øu ch·ªçn ƒë√∫ng, t√¥ ƒë·∫≠m h∆°n ch√∫t ƒë·ªÉ user bi·∫øt m√¨nh ch·ªçn ƒë√∫ng
                btn.classList.add('bg-green-500', 'text-white');
                btn.querySelector('span').classList.remove('bg-green-600', 'text-white');
                btn.querySelector('span').classList.add('bg-white', 'text-green-600');
                btn.classList.add('pop');

                // Inline Feedback
                inlineFeedback.innerHTML = '<span class="text-green-600"><i class="fas fa-check-circle"></i> Ch√≠nh x√°c!</span>';
                inlineFeedback.className = "text-lg font-bold block pl-2 animate-bounce";
                
                icon.innerHTML = '<i class="fas fa-check-circle text-green-500"></i>';
                title.innerText = "Tuy·ªát v·ªùi!";
                title.className = "text-2xl font-bold mb-2 text-green-600";
                msg.innerText = "ƒê√°p √°n ch√≠nh x√°c.";
            } else {
                state.streak = 0;
                state.wrong++;

                // Styles cho c√¢u sai
                btn.classList.remove('bg-blue-50', 'border-gray-100');
                btn.classList.add('bg-red-500', 'border-red-600', 'text-white', 'shake', 'opacity-100');
                btn.querySelector('span').classList.remove('text-blue-600', 'bg-white');
                btn.querySelector('span').classList.add('text-red-600', 'bg-white');

                // Inline Feedback
                inlineFeedback.innerHTML = '<span class="text-red-500"><i class="fas fa-times-circle"></i> Ch∆∞a ƒë√∫ng!</span>';
                inlineFeedback.className = "text-lg font-bold block pl-2";

                // Setup Modal for wrong answer
                icon.innerHTML = '<i class="fas fa-times-circle text-red-500"></i>';
                title.innerText = "Ch∆∞a ch√≠nh x√°c";
                title.className = "text-2xl font-bold mb-2 text-red-600";
                msg.innerText = `ƒê√°p √°n ƒë√∫ng l√†: ${state.currentQuestion.options[state.currentQuestion.correct]}`;
            }

            // Fill Modal Details
            detail.innerHTML = state.currentQuestion.explanation;

            // HI·ªÇN TH·ªä GI·∫¢I TH√çCH INLINE (Sau khi ƒë√≥ng modal user s·∫Ω th·∫•y c√°i n√†y)
            const explArea = document.getElementById('explanation-area');
            explArea.innerHTML = `<p class="font-bold text-blue-800 mb-1"><i class="fas fa-lightbulb text-yellow-500 mr-2"></i>Gi·∫£i th√≠ch chi ti·∫øt:</p> ${state.currentQuestion.explanation}`;
            explArea.classList.remove('hidden');

            // Update Stats
            renderStats();

            // Update Next Button
            const btnNext = document.getElementById('btn-next');
            btnNext.innerHTML = 'Ti·∫øp theo <i class="fas fa-arrow-right ml-2"></i>';
            btnNext.className = "ml-auto bg-blue-600 text-white px-6 py-2 rounded-full font-bold hover:bg-blue-700 transition flex items-center shadow-lg transform scale-105";
            
            // Show modal immediately if wrong
            if (!isCorrect) {
                setTimeout(() => { overlay.classList.remove('hidden'); }, 400);
            }
        }

        function handleNextClick() {
            if (!state.isAnswered) {
                // Skip Logic
                state.streak = 0;
                state.skipped++;
                renderStats();
                generateNewQuestion();
            } else {
                // ƒê√£ tr·∫£ l·ªùi, b·∫•m Next ƒë·ªÉ qua c√¢u m·ªõi
                generateNewQuestion();
            }
        }

        // Thay ƒë·ªïi t√™n h√†m v√† logic ƒë·ªÉ ch·ªâ ƒë√≥ng modal
        function closeModal() {
            document.getElementById('feedback-overlay').classList.add('hidden');
        }

        // Initialize
        initCategoryButtons();
        renderStats();
        generateNewQuestion();

    </script>
</body>
</html>